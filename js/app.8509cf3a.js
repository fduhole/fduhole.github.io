(function(e){function t(t){for(var n,r,s=t[0],l=t[1],c=t[2],d=0,h=[];d<s.length;d++)r=s[d],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&h.push(o[r][0]),o[r]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);u&&u(t);while(h.length)h.shift()();return i.push.apply(i,c||[]),a()}function a(){for(var e,t=0;t<i.length;t++){for(var a=i[t],n=!0,s=1;s<a.length;s++){var l=a[s];0!==o[l]&&(n=!1)}n&&(i.splice(t--,1),e=r(r.s=a[0]))}return e}var n={},o={app:0},i=[];function r(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=n,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var u=l;i.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("cd49")},"0e19":function(e,t,a){"use strict";a("c3a8")},1995:function(e,t,a){"use strict";a("db67")},"1f4a":function(e,t,a){},"4a13":function(e,t,a){"use strict";a("a07e")},5298:function(e,t,a){},"530c":function(e,t,a){"use strict";a("c087")},5386:function(e,t,a){"use strict";a("bf91")},"581e":function(e,t,a){},"5b57":function(e,t,a){"use strict";a("b1e9")},"67cd":function(e,t,a){"use strict";a("d1f0")},"6b51":function(e,t,a){"use strict";a("9064")},"7d1e":function(e,t,a){"use strict";a("581e")},"7fa3":function(e,t,a){},"89a1":function(e,t,a){"use strict";a("7fa3")},"8fde":function(e,t,a){"use strict";a("9fa6")},9064:function(e,t,a){},9224:function(e){e.exports=JSON.parse('{"name":"fduhole-fe","version":"0.8.0","private":true,"scripts":{"serve":"vue-cli-service serve","build":"vue-cli-service build --mode production","build-report":"vue-cli-service build --mode production --report","lint":"vue-cli-service lint"},"dependencies":{"@mdi/font":"^6.4.95","@types/animejs":"^3.1.4","@types/katex":"^0.11.1","@types/lodash-es":"^4.17.5","@types/marked":"^3.0.2","animejs":"^3.2.1","axios":"^0.21.1","core-js":"^3.6.5","github-markdown-css":"^5.0.0","gsap":"^3.8.0","highlight.js":"^11.3.1","katex":"^0.13.20","lodash-es":"^4.17.21","marked":"^3.0.8","quill-image-resize-module":"^3.0.0","quill-image-super-solution-module":"^2.0.0","register-service-worker":"^1.7.1","v-viewer":"^1.5.1","vditor":"^3.8.4","vue":"^2.6.11","vue-cookies":"^1.7.4","vue-router":"^3.2.0","vuetify":"^2.4.0","vuex":"^3.6.2"},"devDependencies":{"@typescript-eslint/eslint-plugin":"^4.18.0","@typescript-eslint/parser":"^4.18.0","@vue/cli-plugin-babel":"~4.5.0","@vue/cli-plugin-eslint":"~4.5.0","@vue/cli-plugin-pwa":"~4.5.0","@vue/cli-plugin-router":"~4.5.0","@vue/cli-plugin-typescript":"~4.5.0","@vue/cli-plugin-vuex":"~4.5.0","@vue/cli-service":"^4.5.13","@vue/eslint-config-standard":"^5.1.2","@vue/eslint-config-typescript":"^7.0.0","babel-eslint":"^10.1.0","eslint":"^6.7.2","eslint-plugin-import":"^2.20.2","eslint-plugin-node":"^11.1.0","eslint-plugin-promise":"^4.2.1","eslint-plugin-standard":"^4.0.0","eslint-plugin-vue":"^6.2.2","sass":"^1.32.0","sass-loader":"^10.0.0","typescript":"~4.1.5","vue-class-component":"^7.2.3","vue-cli-plugin-vuetify":"~2.1.0","vue-property-decorator":"^9.1.2","vue-template-compiler":"^2.6.11","vuetify-loader":"^1.7.0","vuex-module-decorators":"^1.0.1"},"eslintConfig":{"root":true,"env":{"node":true},"extends":["plugin:vue/essential","@vue/standard","@vue/typescript"],"parserOptions":{"parser":"@typescript-eslint/parser"}},"browserslist":["> 1%","last 2 versions","not dead"],"gitHooks":{},"license":"MIT","lint-staged":{"*.{js,jsx,vue}":["vue-cli-service lint","git add"]}}')},"96b7":function(e,t,a){},"9fa6":function(e,t,a){},a07e:function(e,t,a){},a378:function(e,t,a){"use strict";a("e12e")},b1e9:function(e,t,a){},bf91:function(e,t,a){},c087:function(e,t,a){},c3a8:function(e,t,a){},cd49:function(e,t,a){"use strict";a.r(t),a.d(t,"Main",(function(){return Hr}));a("e260"),a("e6cf"),a("cca6"),a("a79d"),a("4de4"),a("d3b7"),a("ac1f"),a("5319");var n=a("2b0e"),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-app",[a("message",{ref:"message"}),a("Navbar"),a("v-main",[a("router-view",{key:e.$route.fullPath+(e.$route.params.id||"")+e.$route.query})],1)],1)},i=[],r=a("d4ec"),s=a("bee2"),l=a("262e"),c=a("2caf"),u=a("9ab4"),d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"navbar"},[a("v-app-bar",{attrs:{app:"","elevate-on-scroll":"",dark:"",color:"primary",dense:"",flat:""}},[e.inBanMenuRoutes?e._e():a("v-app-bar-nav-icon",{attrs:{icon:""},on:{click:function(t){t.stopPropagation(),e.showSidebar=!e.showSidebar}}}),e.inAllowBackRoutes?a("v-app-bar-nav-icon",{attrs:{icon:""},on:{click:function(t){return t.stopPropagation(),e.back.apply(null,arguments)}}},[a("v-icon",[e._v("mdi-arrow-left")])],1):e._e(),a("v-app-bar-title",[e._v("FDU Hole")]),a("v-spacer"),a("notifications-menu")],1),a("v-navigation-drawer",{attrs:{app:""},model:{value:e.showSidebar,callback:function(t){e.showSidebar=t},expression:"showSidebar"}},[a("div",{staticClass:"iphone-fitter"}),a("v-list-item",{attrs:{color:"primary"}},[a("v-list-item-content",[a("v-list-item-title",[e._v("FDU Hole")]),a("v-list-item-subtitle",[e._v("欢迎回来")])],1)],1),a("v-divider"),a("v-list",{attrs:{nav:"",dense:""}},[a("v-list-item-group",{attrs:{color:"primary"}},[e._l(e.$feConfig.navItems,(function(t){return[t.group?a("v-list-group",{key:t.route,attrs:{"no-action":"",color:"primary "+(e.$vuetify.theme.dark?"lighten-1":"darken-2")},scopedSlots:e._u([{key:"activator",fn:function(){return[a("v-list-item-icon",[a("v-icon",{domProps:{textContent:e._s(t.icon)}})],1),a("v-list-item-title",[e._v(e._s(t.title))])]},proxy:!0}],null,!0)},e._l(e.groupNavItem.get(t.route),(function(n){return a("v-list-item",{key:t.route+n.route,class:t.route+n.route===e.$route.fullPath?e.activeClass:"",attrs:{disabled:t.route+n.route===e.$route.fullPath},on:{click:function(a){return a.stopPropagation(),e.$router.replace(t.route+n.route)}}},[a("v-list-item-content",[a("v-list-item-title",{domProps:{textContent:e._s(n.name)}})],1)],1)})),1):a("v-list-item",{key:t.route,class:t.route===e.$route.path?e.activeClass:"",attrs:{disabled:t.route===e.$route.path},on:{click:function(a){return a.stopPropagation(),e.$router.replace(t.route)}}},[a("v-list-item-icon",[a("v-icon",{domProps:{textContent:e._s(t.icon)}})],1),a("v-list-item-content",[a("v-list-item-title",{domProps:{textContent:e._s(t.title)}})],1)],1)]}))],2)],1),a("v-divider"),a("v-list",{staticStyle:{padding:"5px"}},[e.filtedTagMap&&e.filtedTagMap[e.$route.name]?a("v-list-item",[a("TagChip",{key:"filtedTag-"+e.filtedTagMap[e.$route.name].tagId,attrs:{tag:e.filtedTagMap[e.$route.name],remove:!0}})],1):e._e(),a("v-list-item",[a("v-form",[a("v-row",[a("v-text-field",{attrs:{type:"search",placeholder:"搜索"},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}}),a("v-list-item-icon",[a("v-btn",{attrs:{type:"submit",icon:"",disabled:0===e.searchText.length},on:{click:e.search}},[a("v-icon",[e._v("mdi-magnify")])],1)],1)],1)],1)],1),a("v-list-item",[a("v-form",[a("v-row",[a("v-text-field",{attrs:{placeholder:"电梯直达"},model:{value:e.holeToGo,callback:function(t){e.holeToGo=t},expression:"holeToGo"}}),a("v-list-item-icon",[a("v-btn",{attrs:{type:"submit",icon:"",disabled:0===e.holeToGo.length},on:{click:e.gotoHole}},[a("v-icon",[e._v("mdi-elevator")])],1)],1)],1)],1)],1)],1),a("div",{staticClass:"drawer-bottom-container"},[a("v-btn",{attrs:{fab:"",fixed:"",bottom:"",color:"primary"},on:{mousedown:function(e){e.preventDefault()}}},[e._v(" 重载 ")])],1)],1)],1)},h=[],p=a("b85c"),v=(a("4ec9"),a("3ca3"),a("ddb0"),a("159b"),a("25f0"),a("b0c0"),a("1b40")),f=a("6fc5"),m=a("2f62");n["default"].use(m["a"]);var g=new m["a"].Store({}),b=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.message=null,e}return Object(s["a"])(a,[{key:"setMessageComponent",value:function(e){this.message=e}},{key:"messageError",value:function(e){this.message&&this.message.error(e)}},{key:"messageSuccess",value:function(e){this.message&&this.message.success(e)}},{key:"messageWarning",value:function(e){this.message&&this.message.warning(e)}},{key:"messageInfo",value:function(e){this.message&&this.message.info(e)}}]),a}(f["d"]);Object(u["a"])([f["c"]],b.prototype,"setMessageComponent",null),Object(u["a"])([Object(f["a"])({rawError:!0})],b.prototype,"messageError",null),Object(u["a"])([Object(f["a"])({rawError:!0})],b.prototype,"messageSuccess",null),Object(u["a"])([Object(f["a"])({rawError:!0})],b.prototype,"messageWarning",null),Object(u["a"])([Object(f["a"])({rawError:!0})],b.prototype,"messageInfo",null),b=Object(u["a"])([Object(f["b"])({store:g,dynamic:!0,name:"MessageStore",namespaced:!0})],b);var y=Object(f["e"])(b),k=y,O=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.isMobile=!1,e}return Object(s["a"])(a,[{key:"setIsMobile",value:function(e){this.isMobile=e}},{key:"checkDevice",value:function(){this.setIsMobile(document.body.clientWidth<=768)}}]),a}(f["d"]);Object(u["a"])([f["c"]],O.prototype,"setIsMobile",null),Object(u["a"])([f["a"]],O.prototype,"checkDevice",null),O=Object(u["a"])([Object(f["b"])({store:g,dynamic:!0,name:"UtilStore",namespaced:!0})],O);var j=Object(f["e"])(O),w=j,x=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.tagMap={},e}return Object(s["a"])(a,[{key:"addTag",value:function(e){n["default"].set(this.tagMap,e.route,e.tag)}},{key:"clearTag",value:function(e){e?n["default"].delete(this.tagMap,e):this.tagMap={}}}]),a}(f["d"]);Object(u["a"])([f["c"]],x.prototype,"addTag",null),Object(u["a"])([f["c"]],x.prototype,"clearTag",null),x=Object(u["a"])([Object(f["b"])({store:g,dynamic:!0,name:"TagStore",namespaced:!0})],x);var C=Object(f["e"])(x),_=C,I=new n["default"],E=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.setMessageComponent=k.setMessageComponent,e.messageError=k.messageError,e.messageSuccess=k.messageSuccess,e.messageInfo=k.messageInfo,e.messageWarning=k.messageWarning,e.checkDevice=w.checkDevice,e.addTag=function(e,t){return _.addTag({route:e,tag:t})},e.clearTag=_.clearTag,e}return Object(s["a"])(a,[{key:"filtedTagMap",get:function(){return _.tagMap}},{key:"isMobile",get:function(){return w.isMobile}},{key:"onPreloaded",value:function(){}},{key:"onWsMessage",value:function(e){}},{key:"created",value:function(){I.$on("preloaded",this.onPreloaded),I.$on("receive-ws-message",this.onWsMessage)}},{key:"destroyed",value:function(){I.$off("preloaded",this.onPreloaded),I.$off("receive-ws-message",this.onWsMessage)}}]),a}(n["default"]);E=Object(u["a"])([v["a"]],E);var T,V,$=E,S=$,D=a("2877"),M=Object(D["a"])(S,T,V,!1,null,null,null),F=M.exports,R=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-chip",{staticClass:"mx-1 my-1",attrs:{color:e.color,outlined:"",small:"",ripple:""},on:{click:e.onClick}},[e._v(" "+e._s(e.tag.name)+" ")])},L=[],H=a("1da1"),A=a("ade3"),q=a("5530"),B=(a("96cf"),a("d81d"),a("b64b"),a("2ef0")),N=a("3b2f"),P=a.n(N),U=[],W=["red","pink","purple","deep-purple","indigo","blue","light-blue","cyan","teal","green","light-green","yellow","amber","orange","deep-orange","brown","blue-grey","grey"],z=function(e){var t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString()},G=function(e){var t=new Date(e),a=new Date,n=Math.floor((a.getTime()-t.getTime())/1e3);return n<0&&(n=0),n<60?n+"秒前":n<3600?Math.floor(n/60)+"分钟前":n<86400?Math.floor(n/3600)+"小时前":n<604800?Math.floor(n/86400)+"天前":t.getFullYear()===a.getFullYear()?e.substring(5,10):e.substring(0,10)},Y=function e(t){return Array.isArray(t)?t.map((function(t){return e(t)})):null!=t&&t.constructor===Object?Object.keys(t).reduce((function(a,n){return Object(q["a"])(Object(q["a"])({},a),{},Object(A["a"])({},Object(B["camelCase"])(n),e(t[n])))}),{}):t},J=function(e){return e.replace(/\$\$\s([\s\S]+)\s\$\$/g,(function(e,t){return P.a.renderToString(t,{displayMode:!0,macros:U})})).replace(/\$\s([\s\S]+)\s\$/g,(function(e,t){return P.a.renderToString(t,{displayMode:!1})}))},X=function(e,t){var a,n,o=null===(a=document.getElementById(e.toString()))||void 0===a?void 0:a.offsetTop,i=null===(n=document.getElementById(t.toString()))||void 0===n?void 0:n.offsetTop,r=o&&i?i-o:0;window.scrollBy({top:r,left:0,behavior:"smooth"})},K=function(e){if(null===e)return"";if("*"===e[0])return"red";for(var t=0,a=0;a<e.length;a++)t+=e.charCodeAt(a);return t%=W.length,W[t]},Q=function(){var e=Object(H["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){return setTimeout(e,t)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Z=function(e,t){var a,n=Object(p["a"])(t);try{for(n.s();!(a=n.n()).done;){var o=a.value;if(!(o in e))return!1}}catch(i){n.e(i)}finally{n.f()}return!0},ee=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.color="red",e}return Object(s["a"])(a,[{key:"onClick",value:function(){!this.prevent&&this.$route.name&&(this.remove?this.clearTag(this.$route.name):this.addTag(this.$route.name,this.tag))}},{key:"created",value:function(){this.color=K(this.tag.name)}}]),a}(F);Object(u["a"])([Object(v["c"])({required:!0,type:Object})],ee.prototype,"tag",void 0),Object(u["a"])([Object(v["c"])({type:Boolean,default:!1})],ee.prototype,"remove",void 0),Object(u["a"])([Object(v["c"])({type:Boolean,default:!1})],ee.prototype,"prevent",void 0),ee=Object(u["a"])([v["a"]],ee);var te=ee,ae=te,ne=a("6544"),oe=a.n(ne),ie=a("cc20"),re=Object(D["a"])(ae,R,L,!1,null,null,null),se=re.exports;oe()(re,{VChip:ie["a"]});a("caad"),a("2532");var le=a("0e54"),ce=a.n(le),ue=function(){function e(t){Object(r["a"])(this,e),Object.assign(this,t),this.convertHtml()}return Object(s["a"])(e,[{key:"convertHtml",value:function(){this.html=ce()(J(this.content))}}]),e}(),de=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){return Object(r["a"])(this,a),t.apply(this,arguments)}return Object(s["a"])(a,[{key:"convertHtml",value:function(){this.html=this.signMention(J(this.content))}},{key:"signMention",value:function(e){return e=e.replace(/(^|\s)(#\w+)/g,(function(e,t,a){return'\n\n<p mention="'+a+'"></p>\n\n'})),e=ce()(J(e)),e=e.replace(/<p mention="#\w+"><\/p>/g,(function(e){return e.replace("<p",'<div class="replyDiv"').replace("/p>","/div>")})),e}}]),a}(ue),he=function e(t){var a=this;Object(r["a"])(this,e),this.floors=[],this.hole=t,t.floors.prefetch.forEach((function(e){a.floors.push(new ue(e))})),this.firstFloor=new ue(t.floors.firstFloor),this.lastFloor=new ue(t.floors.lastFloor),this.isFolded=this.firstFloor.fold.length>0,this.isStarred=ge.collection.isStarred(t.holeId),this.holeId=this.hole.holeId,this.holeIdStr=this.holeId.toString(),t.tags.forEach((function(e){"*"===e.name.charAt(0)&&(a.isFolded=!0)})),this.styleData={fold:!0,lines:3,displayIt:!this.isFolded}},pe=new n["default"],ve=function(){function e(){Object(r["a"])(this,e),this.collectionIds=[],this.updateHoleMap=new Map}return Object(s["a"])(e,[{key:"clearCollection",value:function(){this.collectionIds=[]}},{key:"setCollection",value:function(e){this.collectionIds=e,this.update()}},{key:"update",value:function(){var e,t=Object(p["a"])(this.updateHoleMap.values());try{for(t.s();!(e=t.n()).done;)for(var a=e.value,o=0;o<a.length;o++)a[o].isStarred!==this.isStarred(a[o].hole.holeId)&&n["default"].set(a,o,new he(a[o].hole))}catch(i){t.e(i)}finally{t.f()}}},{key:"getCollections",value:function(){var e,t=this;null===(e=pe.$axios)||void 0===e||e.get("/user/favorites").then((function(e){t.clearCollection(),e.data.forEach((function(e){!e.floors.first_floor||!e.floors.last_floor||e.reply<0||t.collectionIds.push(e.hole_id)})),t.update()})).catch((function(e){throw new Error(e)}))}},{key:"isStarred",value:function(e){return this.collectionIds.includes(e)}},{key:"registerUpdateHoleArray",value:function(e,t){this.updateHoleMap.set(e,t)}},{key:"unregisterUpdateHoleArray",value:function(e){this.updateHoleMap.delete(e)}}]),e}(),fe=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.collection=new ve,e.divisions=[],e.userProfile=null,e}return Object(s["a"])(a,[{key:"clear",value:function(){this.collection=new ve,this.divisions=[]}},{key:"setDivisions",value:function(e){this.divisions=e}},{key:"setUserProfile",value:function(e){this.userProfile=e}},{key:"requestDivision",value:function(){var e=Object(H["a"])(regeneratorRuntime.mark((function e(){var t,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,null===(t=pe.$axios)||void 0===t?void 0:t.get("/divisions").then((function(e){var t=Y(e.data);a.setDivisions(t)}));case 2:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"requestUserProfile",value:function(){var e=Object(H["a"])(regeneratorRuntime.mark((function e(){var t,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,null===(t=pe.$axios)||void 0===t?void 0:t.get("/users").then((function(e){a.setUserProfile(Y(e.data))}));case 2:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()}]),a}(f["d"]);Object(u["a"])([f["c"]],fe.prototype,"clear",null),Object(u["a"])([f["c"]],fe.prototype,"setDivisions",null),Object(u["a"])([f["c"]],fe.prototype,"setUserProfile",null),Object(u["a"])([f["a"]],fe.prototype,"requestDivision",null),Object(u["a"])([f["a"]],fe.prototype,"requestUserProfile",null),fe=Object(u["a"])([Object(f["b"])({store:g,dynamic:!0,name:"UserStore",namespaced:!0})],fe);var me=Object(f["e"])(fe),ge=me,be=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("app-menu",{key:"notifications-menu",attrs:{"close-on-content-click":!1,"max-width":e.maxWidth,bottom:"","content-class":"overflow-hidden",left:""},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.attrs,o=t.on;return[a("app-tooltip-btn",e._g(e._b({attrs:{text:"通知"},scopedSlots:e._u([{key:"icon",fn:function(){return[a("v-badge",{attrs:{value:e.unread.length,color:"#ED561B",dot:"",left:"",overlap:""}},[a("v-icon",{staticClass:"mx-1",domProps:{textContent:e._s("mdi-bell-"+(0===e.unread.length?"outline":"ring-outline"))}})],1)]},proxy:!0}],null,!0)},"app-tooltip-btn",n,!1),o))]}}]),model:{value:e.menu,callback:function(t){e.menu=t},expression:"menu"}},[a("v-toolbar",{staticClass:"pr-5",attrs:{width:e.maxWidth,flat:"",short:""}},[a("v-btn",{staticClass:"px-2 ml-n1",attrs:{disabled:e.archived?e.unread.length<1:e.read.length<1,small:"",text:""},on:{click:function(t){e.archived=!e.archived}}},[e._v(" View "+e._s(e.archived?"Unread":"Read")+" "+e._s((e.archived?e.unread:e.read).length)+" ")]),a("v-spacer"),e.marked?a("app-tooltip-btn",{attrs:{disabled:e.done,icon:e.marked.icon,text:e.toggleMsg,small:""},on:{click:e.toggleAll}}):e._e()],1),a("v-divider"),a("v-responsive",{ref:"responsive",staticClass:"overflow-y-scroll",attrs:{"max-height":"320"}},[e.done?a("div",{staticClass:"py-8 text-center text-subtitle-1"},[a("div",[e._v("All done")]),a("v-icon",{attrs:{color:"grey lighten-2",size:"96"}},[e._v(" mdi-vuetify ")])],1):e._l(e.filtered,(function(t){return a("v-list-item",{key:t.messageId,attrs:{ripple:!1},on:{click:function(a){return e.select(t)}}},[t.marked&&!e.isMobile?a("notification-floor-card-menu",{attrs:{floor:t.marked},scopedSlots:e._u([{key:"activator",fn:function(n){var o=n.attrs,i=n.on;return[a("v-list-item-content",e._g(e._b({},"v-list-item-content",o,!1),i),[a("div",{staticClass:"grey--text text--darken-1 text-caption font-weight-light text-uppercase",domProps:{textContent:e._s(t.timeCreatedDifference)}}),a("v-list-item-title",{staticClass:"text-subtitle-1",domProps:{textContent:e._s(t.message)}})],1)]}}],null,!0)}):a("v-list-item-content",[a("div",{staticClass:"grey--text text--darken-1 text-caption font-weight-light text-uppercase",domProps:{textContent:e._s(t.timeCreatedDifference)}}),a("v-list-item-title",{staticClass:"text-subtitle-1",domProps:{textContent:e._s(t.message)}})],1),a("v-list-item-action",[a("v-btn",{attrs:{ripple:!1,icon:""},on:{click:function(a){return a.stopPropagation(),a.preventDefault(),e.toggle(t.messageId)}}},[a("v-icon",{domProps:{textContent:e._s(e.marked.icon)}})],1)],1)],1)}))],2)],1)},ye=[],ke=a("2909"),Oe=(a("4e827"),a("99af"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-menu",e._g(e._b({attrs:{bottom:"","close-delay":"100","content-class":"rounded",left:"","max-height":"500","offset-y":"","open-delay":"60","open-on-hover":"","close-on-click":!1,transition:"slide-y-transition"},scopedSlots:e._u([{key:"activator",fn:function(t){return[e._t("activator",null,null,Object.assign({},t))]}}],null,!0)},"v-menu",e.$attrs,!1),e.$listeners),[a("app-sheet",{attrs:{outlined:!1}},[e._t("default")],2)],1)}),je=[],we=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-sheet",e._g(e._b({staticClass:"overflow-hidden"},"v-sheet",Object.assign({},{outlined:!0,rounded:!0},e.$attrs),!1),e.$listeners),[e._t("default")],2)},xe=[],Ce=a("2fe1"),_e=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){return Object(r["a"])(this,a),t.apply(this,arguments)}return a}(n["default"]);_e=Object(u["a"])([Ce["b"]],_e);var Ie=_e,Ee=Ie,Te=a("8dd9"),Ve=Object(D["a"])(Ee,we,xe,!1,null,null,null),$e=Ve.exports;oe()(Ve,{VSheet:Te["a"]});var Se=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){return Object(r["a"])(this,a),t.apply(this,arguments)}return a}(n["default"]);Se=Object(u["a"])([Object(Ce["b"])({components:{AppSheet:$e}})],Se);var De=Se,Me=De,Fe=a("e449"),Re=Object(D["a"])(Me,Oe,je,!1,null,null,null),Le=Re.exports;oe()(Re,{VMenu:Fe["a"]});var He=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"v-app-tooltip-btn d-inline-block"},[a("v-tooltip",{attrs:{bottom:"","content-class":"v-app-tooltip-btn__content","open-delay":"200"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on;return[a("v-btn",e._g(e._b({attrs:{"aria-label":e.text,icon:""}},"v-btn",e.$attrs,!1),Object.assign({},n,e.$listeners)),[e.$slots.icon?e._t("icon"):a("v-icon",{domProps:{textContent:e._s(e.icon)}})],2)]}}],null,!0)},[a("span",[e._v(e._s(e.text))])])],1)},Ae=[],qe=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.inheritAttrs=!1,e}return a}(n["default"]);Object(u["a"])([Object(v["c"])({type:String})],qe.prototype,"icon",void 0),Object(u["a"])([Object(v["c"])({required:!0,type:String})],qe.prototype,"text",void 0),qe=Object(u["a"])([v["a"]],qe);var Be=qe,Ne=Be,Pe=(a("6b51"),a("8336")),Ue=a("132d"),We=a("3a2f"),ze=Object(D["a"])(Ne,He,Ae,!1,null,null,null),Ge=ze.exports;function Ye(e){var t=["message"];return Z(e,t)}function Je(e){return Ke(e)?new Qe(e):Ye(e)?new Xe(e):null}oe()(ze,{VBtn:Pe["a"],VIcon:Ue["a"],VTooltip:We["a"]});var Xe=function e(t){Object(r["a"])(this,e),Object.assign(this,t)};function Ke(e){var t=["message","messageId","code","data","hasRead","timeCreated"];return Z(e,t)}var Qe=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){return Object(r["a"])(this,a),t.apply(this,arguments)}return a}(Xe),Ze=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-menu",{attrs:{"close-on-content-click":!1,"nudge-width":150,"nudge-left":18,"offset-x":"","open-on-hover":"",left:""},scopedSlots:e._u([{key:"activator",fn:function(t){return[e._t("activator",null,null,Object.assign({},t))]}}],null,!0),model:{value:e.menu,callback:function(t){e.menu=t},expression:"menu"}},[a("app-sheet",{attrs:{outlined:!1}},[a("FloorCard",{attrs:{floor:e.floor,"no-action":!0}})],1)],1)},et=[],tt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"rounded",attrs:{id:e.index}},[a("v-card-text",{staticClass:"d-flex pb-4 pt-2 text-body-2"},[a("span",{staticClass:"flex-left"},[e._v(" "+e._s(e.floor.anonyname)+" ")]),a("span",{staticClass:"flex-center"},[e._v(" "+e._s(e._f("timeDifference")(e.floor.timeCreated))+" ")]),a("span",{staticClass:"flex-right"},[e.noAction?e._e():[1===e.operations.length?a("v-btn",{staticClass:"grey--text",staticStyle:{"padding-bottom":"-10px"},attrs:{small:"",text:""},on:{click:e.report}},[a("v-icon",[e._v("mdi-alert-outline")]),a("br"),a("span",[e._v("举报")])],1):a("v-menu",{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,o=t.attrs;return[a("v-btn",e._g(e._b({staticClass:"grey--text",staticStyle:{"padding-bottom":"-10px"},attrs:{small:"",text:""}},"v-btn",o,!1),n),[a("v-icon",[e._v("mdi-dots-horizontal")]),a("br"),a("span",[e._v("更多")])],1)]}}],null,!1,470267379)},[a("v-list",e._l(e.operations,(function(t){return a("v-list-item",{key:"operation-"+t.text},[a("v-btn",{staticClass:"grey--text",staticStyle:{"padding-bottom":"-10px"},attrs:{small:"",text:""},on:{click:t.operation}},[a("v-icon",[e._v("mdi-"+e._s(t.icon))]),a("br"),a("span",[e._v(e._s(t.text))])],1)],1)})),1)],1)]],2)]),a("v-card-text",{staticClass:"py-0"},[a("div",{staticClass:"floor-body markdown-body rich-text text--primary ma-0 text-body-1",attrs:{index:e.index},domProps:{innerHTML:e._s(e.floor.html)}})]),a("v-card-text",{staticClass:"d-flex text-body-2 pb-2"},[a("span",{staticClass:"flex-left",domProps:{innerHTML:e._s(e.idInfo)}}),a("span",{staticClass:"flex-center"},[e.noAction?e._e():a("v-btn",{staticClass:"grey--text",staticStyle:{"padding-bottom":"-10px"},attrs:{small:"",text:""},on:{click:function(t){return e.$emit("reply")}}},[a("v-icon",[e._v("mdi-reply-outline")]),a("br"),a("span",[e._v("回复")])],1)],1),a("span",{staticClass:"flex-right"},[a("v-btn",{staticClass:"grey--text",staticStyle:{"padding-bottom":"-10px"},attrs:{small:"",text:""},on:{click:e.like}},[e.floor.liked?a("v-icon",[e._v("mdi-thumb-up")]):a("v-icon",[e._v("mdi-thumb-up-outline")]),a("br"),a("span",[e._v(e._s(e.floor.like))])],1)],1)])],1)},at=[],nt=(a("a9e3"),function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.operations=[],e}return Object(s["a"])(a,[{key:"idInfo",get:function(){return-1===this.index?"<b>#".concat(this.floor.floorId,"</b>"):"<b>".concat(this.index,"L</b>(#").concat(this.floor.floorId,")")}},{key:"setOperation",value:function(){var e,t=this,a={icon:"alert-outline",text:"举报",operation:this.report},n={icon:"close-box-outline",text:"删除本层",operation:function(){return t.removeFloor(!1)}},o={icon:"close-box-outline",text:"删除本层",operation:function(){return t.removeFloor(!0)}},i={icon:"pencil-outline",text:"编辑",operation:function(){return t.$emit("edit")}},r={icon:"close-outline",text:"处罚",operation:this.penalty};this.floor instanceof de&&this.floor.isMe?this.operations=[n,i]:null!==(e=ge.userProfile)&&void 0!==e&&e.isAdmin?this.operations=[o,i,r]:this.operations=[a]}},{key:"floorChanged",value:function(){this.setOperation()}},{key:"penalty",value:function(){var e=prompt("输入惩罚等级");if(null!=e){var t=parseInt(e);(isNaN(t)||t<0||t>3)&&this.messageError("非有效惩罚等级！（惩罚应为0,1,2或3）"),this.$axios.post("/penalty/".concat(this.floor.floorId))}}},{key:"like",value:function(){var e=this;if(this.floor instanceof de){this.floor.liked?n["default"].set(this.floor,"like",this.floor.like-1):this.floor.like++;var t={like:this.floor.liked?"cancel":"add"};n["default"].set(this.floor,"liked",!this.floor.liked),this.$axios.put("/floors/".concat(this.floor.floorId),t).then((function(t){t.data.liked?e.messageSuccess("点赞成功"):e.messageSuccess("取消点赞成功")})).catch((function(t){console.log(t),t.response&&t.response.data.message?e.messageError(t.response.data.message):t.status?e.messageError("未知错误，状态码："+t.status):e.messageError(t)}))}}},{key:"removeFloor",value:function(e){var t=this,a="";if(!e||(a=prompt("输入删除理由"),null!==a)){var n={};a&&(n.delete_reason=a),this.$axios.delete("/floors/".concat(this.floor.floorId),n).then((function(e){200===e.status?t.messageSuccess("删除成功"):t.messageError(e.data.msg)})).catch((function(e){"response"in e?403===e.response.status&&t.messageError("没有权限删除"):t.messageError(e)}))}}},{key:"report",value:function(){var e=this,t=prompt("输入举报理由");""===t&&this.messageError("举报理由不能为空！"),this.$axios.post("/reports",{floor_id:this.floor.floorId,reason:t}).then((function(t){200===t.status?e.messageSuccess("举报成功"):e.messageError(t.data.msg)}))}}]),a}(F));Object(u["a"])([Object(v["c"])({required:!0,type:Object})],nt.prototype,"floor",void 0),Object(u["a"])([Object(v["c"])({required:!1,type:Number,default:-1})],nt.prototype,"index",void 0),Object(u["a"])([Object(v["c"])({required:!1,type:Boolean,default:!1})],nt.prototype,"noAction",void 0),Object(u["a"])([Object(v["e"])("floor",{immediate:!0})],nt.prototype,"floorChanged",null),nt=Object(u["a"])([v["a"]],nt);var ot=nt,it=ot,rt=a("b0af"),st=a("99d9"),lt=a("8860"),ct=a("da13"),ut=Object(D["a"])(it,tt,at,!1,null,"ad8c63ca",null),dt=ut.exports;oe()(ut,{VBtn:Pe["a"],VCard:rt["a"],VCardText:st["c"],VIcon:Ue["a"],VList:lt["a"],VListItem:ct["a"],VMenu:Fe["a"]});var ht=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.menu=!1,e}return a}(n["default"]);Object(u["a"])([Object(v["c"])({required:!0})],ht.prototype,"floor",void 0),ht=Object(u["a"])([Object(v["a"])({components:{FloorCard:dt,AppSheet:$e}})],ht);var pt=ht,vt=pt,ft=Object(D["a"])(vt,Ze,et,!1,null,"2220700a",null),mt=ft.exports;oe()(ft,{VMenu:Fe["a"]});a("1e25");var gt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"reply mx-0 mb-2",class:e.additionalClass},[a("v-card-actions",{staticClass:"pb-0 pl-4 pr-4 pt-2 text-body-2"},[a("span",{staticStyle:{color:"rgba(85,93,86,0.48)"}},[a("b",[e._v(e._s(e.mentionFloor.anonyname))]),e._v(" "+e._s(e.mentionFloorInfo)+" ")]),a("v-spacer"),e.gotoMentionFloor?a("v-icon",{attrs:{small:""},on:{click:e.gotoMentionFloor}},[e._v(" "+e._s(e.gotoMentionFloorIcon)+" ")]):e.cancel?a("v-icon",{attrs:{small:""},on:{click:e.cancel}},[e._v(" mdi-close ")]):e._e()],1),a("v-card-text",{staticClass:"reply-text pt-2 pb-2",class:e.clipClass,domProps:{innerHTML:e._s(e.mentionFloor.html)}}),e.needClip?a("v-btn",{staticClass:"btn-fixed-br",attrs:{text:"",block:"",depressed:"","x-small":"",color:"grey lighten-1"},on:{click:function(t){e.isClipped=!e.isClipped}}},[a("v-spacer"),e.isClipped?a("v-icon",[e._v("mdi-chevron-double-down")]):a("v-icon",[e._v("mdi-chevron-double-up")])],1):e._e()],1)},bt=[],yt=a("1020"),kt=a.n(yt),Ot=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.maxHeight=200,e.needClip=!1,e.isClipped=!1,e}return Object(s["a"])(a,[{key:"clipClass",get:function(){return this.isClipped?" reply-clip":""}},{key:"mounted",value:function(){if(kt.a.highlightAll(),this.$el){var e=parseInt(window.getComputedStyle(this.$el).height);e>this.maxHeight&&(this.needClip=!0,this.isClipped=!0)}}}]),a}(F);Object(u["a"])([Object(v["c"])({required:!0})],Ot.prototype,"mentionFloor",void 0),Object(u["a"])([Object(v["c"])({type:Function})],Ot.prototype,"gotoMentionFloor",void 0),Object(u["a"])([Object(v["c"])({type:String,default:"mdi-arrow-collapse-up"})],Ot.prototype,"gotoMentionFloorIcon",void 0),Object(u["a"])([Object(v["c"])({type:String,default:""})],Ot.prototype,"mentionFloorInfo",void 0),Object(u["a"])([Object(v["c"])({type:String,default:""})],Ot.prototype,"additionalClass",void 0),Object(u["a"])([Object(v["c"])({type:Function})],Ot.prototype,"cancel",void 0),Ot=Object(u["a"])([v["a"]],Ot);var jt=Ot,wt=jt,xt=(a("f240"),a("2fa4")),Ct=Object(D["a"])(wt,gt,bt,!1,null,"2ea23f8e",null),_t=Ct.exports;oe()(Ct,{VBtn:Pe["a"],VCard:rt["a"],VCardActions:st["a"],VCardText:st["c"],VIcon:Ue["a"],VSpacer:xt["a"]});var It=a("f309"),Et=a("fcf4");n["default"].use(It["a"]);var Tt=new It["a"]({theme:{themes:{light:{primary:Et["a"].blue},dark:{primary:Et["a"].blueGrey}}}});function Vt(e,t){return $t.apply(this,arguments)}function $t(){return $t=Object(H["a"])(regeneratorRuntime.mark((function e(t,a){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!("mention"in t)||0===t.mention.length){e.next=4;break}return e.next=3,n["default"].nextTick();case 3:St(t,a);case 4:case"end":return e.stop()}}),e)}))),$t.apply(this,arguments)}function St(e,t){for(var a,n=null!==(a=null===t||void 0===t?void 0:t.getIndex(e.floorId))&&void 0!==a?a:-1,o=document.querySelectorAll('div[index="'+n+'"] > div.replyDiv'),i=function(a){var i;if(o[a].innerHTML)return"continue";var r=o[a].getAttribute("mention");if(!r)return"continue";var s=parseInt(r.substring(1)),l=null;if(e.mention.forEach((function(e){e.floorId===s&&(l=e)})),!l)return"continue";var c=new ue(l),u=void 0,d=null!==(i=null===t||void 0===t?void 0:t.getIndex(s))&&void 0!==i?i:-1;u=-1!==d?function(){X(n,d)}:-1!==n?function(){Dt(e,c)}:function(){Mt(e.holeId,e.floorId)};var h="";o[a].parentElement&&o[a].parentElement.firstChild!==o[a]&&(h+="mt-3 "),o[a].parentElement&&o[a].parentElement.lastChild!==o[a]&&(h+="mb-3 "),h=h.trimEnd(),new _t({propsData:{mentionFloor:c,gotoMentionFloor:u,gotoMentionFloorIcon:"mdi-arrow-collapse-up",mentionFloorInfo:-1===d?"#"+c.floorId:d.toString()+"L",additionalClass:h},vuetify:Tt}).$mount(o[a])},r=0;r<o.length;r++)i(r)}function Dt(e,t){w.isMobile?Mt(t.holeId,t.floorId):I.$emit("goto-mention-floor",e,t)}function Mt(e,t,a){w.isMobile?void 0!==t?Hr.$router.push({path:"/hole/".concat(e),query:{mention:t.toString()}}):Hr.$router.push({path:"/hole/".concat(e)}):void 0===t?I.$emit("goto-hole",e):void 0===a?I.$emit("goto-hole",e,t):I.$emit("goto-hole",e,t,a)}var Ft=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.archived=!1,e.icons={read:"mdi-email-open",unread:"mdi-email-mark-as-unread"},e.menu=!1,e.readRaw=[],e.unreadRaw=[],e}return Object(s["a"])(a,[{key:"read",get:function(){return this.readRaw.map((function(e){if(!("floorId"in e.data))return Object(q["a"])(Object(q["a"])({},e),{},{timeCreatedDifference:G(e.timeCreated)});var t=new de(e.data);return Vt(t),Object(q["a"])(Object(q["a"])({},e),{},{timeCreatedDifference:G(e.timeCreated),marked:t})}))}},{key:"unread",get:function(){return this.unreadRaw.map((function(e){if(!("floorId"in e.data))return Object(q["a"])(Object(q["a"])({},e),{},{timeCreatedDifference:G(e.timeCreated)});var t=new de(e.data);return Vt(t),Object(q["a"])(Object(q["a"])({},e),{},{timeCreatedDifference:G(e.timeCreated),marked:t})}))}},{key:"done",get:function(){return 0===this.filtered.length}},{key:"filtered",get:function(){return this.archived?this.read:this.unread}},{key:"marked",get:function(){var e=this.archived?"unread":"read",t=this.icons[e];return t&&e?{icon:t}:null}},{key:"maxWidth",get:function(){return this.isMobile?296:450}},{key:"toggleMsg",get:function(){return this.archived?"标记为未读":"标记为已读"}},{key:"select",value:function(e){Mt(e.data.holeId,e.data.floorId),this.toggle(e.messageId),this.menu=!1}},{key:"toggle",value:function(e){this.$ws.sendAction({action:this.archived?"unread":"read",id:e});var t=this.readRaw.concat(this.unreadRaw).sort((function(e,t){return t.messageId-e.messageId}));t.forEach((function(t){t.messageId===e&&(t.hasRead=!t.hasRead)})),this.readRaw=t.filter((function(e){return e.hasRead})),this.unreadRaw=t.filter((function(e){return!e.hasRead}))}},{key:"toggleAll",value:function(){var e=this;this.archived?this.readRaw.forEach((function(t){e.$ws.sendAction({action:"unread",id:t.messageId})})):this.$ws.sendAction({action:"clear"});var t=this.readRaw.concat(this.unreadRaw).sort((function(e,t){return t.messageId-e.messageId}));this.readRaw=this.unreadRaw=[],this.archived?this.unreadRaw=t:this.readRaw=t}},{key:"onWsMessage",value:function(e){if(e instanceof Qe){for(var t=this.readRaw.concat(this.unreadRaw),a=!1,n=0;n<t.length;n++)if(t[n].messageId===e.messageId){t[n]=e,a=!0;break}a||(t=[].concat(Object(ke["a"])(t),[e])),t=t.sort((function(e,t){return t.messageId-e.messageId})),this.readRaw=t.filter((function(e){return e.hasRead})),this.unreadRaw=t.filter((function(e){return!e.hasRead}))}}}]),a}(F);Object(u["a"])([Object(v["d"])()],Ft.prototype,"responsive",void 0),Ft=Object(u["a"])([Object(v["a"])({components:{NotificationFloorCardMenu:mt,AppMenu:Le,AppTooltipBtn:Ge}})],Ft);var Rt=Ft,Lt=Rt,Ht=a("4ca6"),At=a("ce7e"),qt=a("1800"),Bt=a("5d23"),Nt=a("6b53"),Pt=a("71d9"),Ut=Object(D["a"])(Lt,be,ye,!1,null,null,null),Wt=Ut.exports;oe()(Ut,{VBadge:Ht["a"],VBtn:Pe["a"],VDivider:At["a"],VIcon:Ue["a"],VListItem:ct["a"],VListItemAction:qt["a"],VListItemContent:Bt["a"],VListItemTitle:Bt["c"],VResponsive:Nt["a"],VSpacer:xt["a"],VToolbar:Pt["a"]});var zt=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.isDarkTheme=!1,e.searchText="",e.showSidebar=!e.isMobile,e.currentPage=0,e.inAllowBackRoutes=!1,e.inBanMenuRoutes=!0,e.holeToGo="",e.groupNavItem=new Map,e}return Object(s["a"])(a,[{key:"activeClass",get:function(){return{"v-list-item--active":!0,"white--text":this.$vuetify.theme.dark}}},{key:"search",value:function(){"search"!==this.$route.path&&this.$router.push({name:"search",query:{wd:this.searchText}}),I.$emit("search",this.searchText),this.searchText=""}},{key:"gotoHole",value:function(){var e="#"===this.holeToGo.charAt(0)?parseInt(this.holeToGo.substring(1)):parseInt(this.holeToGo);"/home"===this.$route.path||"/division"===this.$route.path?Mt(e):this.$router.push("/home").then((function(){Mt(e)})),this.holeToGo=""}},{key:"onPreloaded",value:function(){var e=[];ge.divisions.forEach((function(t){e.push({route:"/"+t.divisionId.toString(),name:t.name})})),this.groupNavItem=new Map(this.groupNavItem.set("/division",e))}},{key:"back",value:function(){this.$router.back()}},{key:"mounted",value:function(){this.$nextTick(this.checkDevice),this.showSidebar=!this.isMobile}},{key:"isDarkThemeChange",value:function(){this.$vuetify.theme.dark=this.isDarkTheme,console.log("%c [切换主题] 当前主题 %c ".concat(this.$vuetify.theme.dark?"dark":"light"," %c"),"background:#35495e ; padding: 1px; border-radius: 3px 0 0 3px;  color: #fff","background:#41b883 ; padding: 1px; border-radius: 0 3px 3px 0;  color: #fff","background:transparent")}},{key:"routeChange",value:function(){var e=this;this.isDarkTheme=matchMedia("(prefers-color-scheme: dark)").matches,matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(function(t){e.isDarkTheme=t.matches})),this.inAllowBackRoutes=function(){var t,a,n=e.$router.currentRoute.name,o=Object(p["a"])(e.$feConfig.allowBackRoutes);try{for(o.s();!(a=o.n()).done;)if(t=a.value,n===t)return!0}catch(i){o.e(i)}finally{o.f()}return!1}(),this.inBanMenuRoutes=function(){var t,a,n=e.$router.currentRoute.name,o=Object(p["a"])(e.$feConfig.banMenuRoutes);try{for(o.s();!(a=o.n()).done;)if(t=a.value,n===t)return!0}catch(i){o.e(i)}finally{o.f()}return!1}()}}]),a}(F);Object(u["a"])([Object(v["e"])("isDarkTheme")],zt.prototype,"isDarkThemeChange",null),Object(u["a"])([Object(v["e"])("$route",{immediate:!0})],zt.prototype,"routeChange",null),zt=Object(u["a"])([Object(v["a"])({components:{NotificationsMenu:Wt,TagChip:se}})],zt);var Gt=zt,Yt=Gt,Jt=(a("67cd"),a("40dc")),Xt=a("5bc1"),Kt=a("bb78"),Qt=a("4bd4"),Zt=a("56b0"),ea=a("1baa"),ta=a("34c3"),aa=a("f774"),na=a("0fd9"),oa=a("8654"),ia=Object(D["a"])(Yt,d,h,!1,null,"094aa579",null),ra=ia.exports;oe()(ia,{VAppBar:Jt["a"],VAppBarNavIcon:Xt["a"],VAppBarTitle:Kt["a"],VBtn:Pe["a"],VDivider:At["a"],VForm:Qt["a"],VIcon:Ue["a"],VList:lt["a"],VListGroup:Zt["a"],VListItem:ct["a"],VListItemContent:Bt["a"],VListItemGroup:ea["a"],VListItemIcon:ta["a"],VListItemSubtitle:Bt["b"],VListItemTitle:Bt["c"],VNavigationDrawer:aa["a"],VRow:na["a"],VSpacer:xt["a"],VTextField:oa["a"]});var sa=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-snackbar",{attrs:{top:"",color:e.type,timeout:e.timeout},model:{value:e.isAlert,callback:function(t){e.isAlert=t},expression:"isAlert"}},[a("v-icon",{attrs:{left:""}},[e._v(" "+e._s(e.icon)+" ")]),e._v(" "+e._s(e.message)+" ")],1)],1)},la=[],ca=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.isAlert=!1,e.type="info",e.message="",e.icon="",e.timeout="2000",e}return Object(s["a"])(a,[{key:"mounted",value:function(){this.setMessageComponent(this)}},{key:"alert",value:function(){var e=this;this.isAlert?(this.isAlert=!1,this.$nextTick((function(){e.isAlert=!0}))):this.isAlert=!0}},{key:"success",value:function(e){this.type="success",this.message=e,this.icon="mdi-check-circle-outline",this.alert()}},{key:"info",value:function(e){this.type="info",this.message=e,this.icon="mdi-alert-circle-outline",this.alert()}},{key:"warning",value:function(e){this.type="warning",this.message=e,this.icon="mdi-alert-outline",this.alert()}},{key:"error",value:function(e){this.type="error",this.message=e,this.icon="mdi-alert-octagram-outline",this.alert()}}]),a}(F);ca=Object(u["a"])([v["a"]],ca);var ua=ca,da=ua,ha=a("2db4"),pa=Object(D["a"])(da,sa,la,!1,null,null,null),va=pa.exports;oe()(pa,{VIcon:Ue["a"],VSnackbar:ha["a"]});a("5298"),a("e4cb"),a("be0f"),a("2c43");var fa=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e._token=localStorage.getItem("token")||"",e._email=localStorage.getItem("email")||"",e._newcomer=localStorage.getItem("newcomer")||"",e}return Object(s["a"])(a,[{key:"token",get:function(){return this._token}},{key:"tokenNoPrefix",get:function(){var e;return null===(e=this._token)||void 0===e?void 0:e.substring(6)}},{key:"email",get:function(){return this._email}},{key:"newcomer",get:function(){return this._newcomer}},{key:"setToken",value:function(e){this._token=e,localStorage.setItem("token",e)}},{key:"setEmail",value:function(e){this._email=e,localStorage.setItem("email",e)}},{key:"setNewcomer",value:function(e){this._newcomer=e,localStorage.setItem("newcomer",e)}},{key:"clear",value:function(){localStorage.clear(),this._token="",this._email="",this._newcomer=""}}]),a}(f["d"]);Object(u["a"])([f["c"]],fa.prototype,"setToken",null),Object(u["a"])([f["c"]],fa.prototype,"setEmail",null),Object(u["a"])([f["c"]],fa.prototype,"setNewcomer",null),Object(u["a"])([f["c"]],fa.prototype,"clear",null),fa=Object(u["a"])([Object(f["b"])({store:g,dynamic:!0,name:"LocalStorageStore",namespaced:!0})],fa);var ma=Object(f["e"])(fa),ga=ma,ba=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){return Object(r["a"])(this,a),t.apply(this,arguments)}return Object(s["a"])(a,[{key:"hasToken",get:function(){return!!ga.token}},{key:"created",value:function(){var e=this;document.addEventListener("onlined",(function(t){e.messageSuccess(t.detail)})),document.addEventListener("offlined",(function(t){e.messageWarning(t.detail)}))}}]),a}(F);ba=Object(u["a"])([Object(v["a"])({components:{Navbar:ra,Message:va}})],ba);var ya=ba,ka=ya,Oa=a("7496"),ja=a("f6c4"),wa=Object(D["a"])(ka,o,i,!1,null,null,null),xa=wa.exports;oe()(wa,{VApp:Oa["a"],VMain:ja["a"]});var Ca=a("9483");Object(Ca["a"])("".concat("/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered."),navigator.serviceWorker.addEventListener("message",(function(e){"success"===e.data.status&&document.dispatchEvent(new CustomEvent("onlined",{detail:e.data.msg})),"warning"===e.data.status&&document.dispatchEvent(new CustomEvent("offlined",{detail:e.data.msg}))}))},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});var _a=a("8c4f"),Ia=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{attrs:{"fill-height":""}},[a("v-row",{attrs:{align:"center",justify:"center"}},[a("v-col",{staticClass:"text-center",attrs:{cols:"10",sm:"8",md:"6",lg:"4"}},[a("v-card",{staticClass:"py-8",attrs:{elevation:"4"}},[a("h1",[e._v("登录")]),a("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[a("div",{staticClass:"pl-7 pr-10"},[a("v-text-field",{attrs:{label:"edu邮箱","prepend-icon":"mdi-email",clearable:!e.valid,counter:32,"error-messages":e.errorMsg.email,rules:e.notEmptyRules},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}}),a("v-text-field",{attrs:{label:"密码","prepend-icon":"mdi-lock",type:"password",clearable:!e.valid,counter:32,rules:e.passwordRules},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.login.apply(null,arguments)}},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1),a("div",{staticClass:"px-10"},[a("v-btn",{staticClass:"my-4",attrs:{color:"primary",block:"",disabled:!e.valid},on:{click:e.login}},[e._v(" 登录 ")])],1),a("div",[a("v-btn",{attrs:{text:"",color:"primary",href:"#/license"}},[e._v(" 登录意味着你同意这些协议 ")])],1),a("div",[a("v-btn",{attrs:{text:"",color:"primary",href:"#/register"}},[e._v(" 没有账号？点此注册 ")])],1),a("div",[a("v-btn",{attrs:{text:"",color:"primary",href:"#/forgetpassword"}},[e._v(" 忘记密码 ")])],1)])],1)],1)],1)],1)},Ea=[],Ta=(a("00b4"),function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){return Object(r["a"])(this,a),t.apply(this,arguments)}return Object(s["a"])(a,[{key:"preload",value:function(){var e=Object(H["a"])(regeneratorRuntime.mark((function e(){var t,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(ga.token){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,this.$ws.isConnecting()||this.$ws.isConnected()||this.$ws.connect(),t=ge.requestDivision,a=ge.requestUserProfile,n=[t(),a()],e.next=9,Promise.all(n);case 9:I.$emit("preloaded"),e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](2),console.log(e.t0),this.messageError(e.t0);case 16:case"end":return e.stop()}}),e,this,[[2,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"created",value:function(){this.preload()}}]),a}(F));Ta=Object(u["a"])([v["a"]],Ta);var Va,$a,Sa=Ta,Da=Sa,Ma=Object(D["a"])(Da,Va,$a,!1,null,null,null),Fa=Ma.exports,Ra=a("85b1"),La=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.alert=!1,e.valid=!0,e.email="",e.password="",e.notEmptyRules=[function(e){return!!e||"内容不能为空"}],e.passwordRules=[function(e){return!!e||"密码不能为空"},function(e){return e.length<=32||"密码不能超过32字符"},function(e){return e.length>=8||"密码不能少于8字符"}],e.errorMsg={email:""},e}return Object(s["a"])(a,[{key:"login",value:function(){var e=this;this.$refs.form.validate(),this.$axios.post("login",{email:this.email,password:this.password}).then((function(t){"登录成功！"===t.data.message?(e.messageSuccess(t.data.message),ga.setToken("token "+t.data.token),ga.setEmail(e.email),e.$router.replace("/home"),e.preload()):(e.valid=!1,e.messageError(t.data.message))})).catch((function(){e.valid=!1,e.messageError("用户名或密码错误")}))}},{key:"checkEmail",value:function(){/^[0-9]{11}@(m\.)?fudan\.edu\.cn$/.test(this.email)?this.errorMsg.email="":this.errorMsg.email="@fudan.edu.cn"}},{key:"emailChanged",value:function(){this.debouncedCheckEmail()}},{key:"created",value:function(){this.debouncedCheckEmail=Object(Ra["a"])(this.checkEmail,500)}}]),a}(Fa);Object(u["a"])([Object(v["e"])("email")],La.prototype,"emailChanged",null),La=Object(u["a"])([v["a"]],La);var Ha=La,Aa=Ha,qa=a("62ad"),Ba=a("a523"),Na=Object(D["a"])(Aa,Ia,Ea,!1,null,null,null),Pa=Na.exports;oe()(Na,{VBtn:Pe["a"],VCard:rt["a"],VCol:qa["a"],VContainer:Ba["a"],VForm:Qt["a"],VRow:na["a"],VTextField:oa["a"]});var Ua=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{staticClass:"pa-0"},[a("newcomer"),e.isMobile?a("HoleListMobile",{ref:"holeComp"}):a("HolePanel",{ref:"holeComp",on:{"show-floor-list-changed":e.onShowFloatBtnChanged}}),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showFloatBtn,expression:"showFloatBtn"}],staticClass:"float-btn"},[a("v-btn",{attrs:{fab:"",color:"secondary"},on:{mousedown:function(e){e.preventDefault()},click:e.reload}},[a("v-icon",[e._v("mdi-autorenew")])],1),a("br"),a("v-dialog",{attrs:{persistent:"","max-width":"600px"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,o=t.attrs;return[a("v-btn",e._g(e._b({attrs:{fab:"",color:"secondary"},on:{mousedown:function(e){e.preventDefault()},click:e.openDialog}},"v-btn",o,!1),n),[a("v-icon",[e._v("mdi-message-plus")])],1)]}}]),model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[a("v-card",[a("v-card-title",[a("span",{staticClass:"headline"},[e._v("发表树洞")])]),a("v-card-text",[a("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[a("v-combobox",{attrs:{items:e.divisions,"item-text":"name",label:"分区","hide-selected":""},model:{value:e.selectedDivision,callback:function(t){e.selectedDivision=t},expression:"selectedDivision"}}),a("v-combobox",{attrs:{items:e.tags,"item-text":"name","item-value":"name",label:"标签",hint:"回车新增标签",rules:e.tagRules,"error-messages":e.errorMsg["tags"],counter:5,"hide-selected":"",clearable:"",multiple:""},scopedSlots:e._u([{key:"selection",fn:function(t){return[a("v-chip",e._b({key:JSON.stringify(t.item),attrs:{"input-value":t.selected,disabled:t.disabled,outlined:"",color:"red",small:""},on:{"click:close":function(e){return t.parent.selectItem(t.item)}}},"v-chip",t.attrs,!1),[e._v(" "+e._s(t.item.name)+" "),a("span",{staticClass:"tag-icon"},[a("v-icon",{attrs:{"x-small":""}},[e._v("mdi-fire")])],1),a("span",[e._v(" "+e._s(t.item.temperature)+" ")])])]}},{key:"item",fn:function(t){return[a("v-list-item-content",[a("span",{class:"red--text"},[e._v(" "+e._s(t.item.name)+" "),a("v-icon",{staticClass:"tag-icon",attrs:{color:"red",small:""}},[e._v("mdi-fire")]),a("span",{staticClass:"tag-count"},[e._v(" "+e._s(t.item.temperature)+" ")])],1)])]}}]),model:{value:e.selectedTags,callback:function(t){e.selectedTags=t},expression:"selectedTags"}}),a("editor",{ref:"editor",attrs:{contentName:e.contentName},on:{error:e.editorError}})],1)],1),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"primary",text:""},on:{click:e.closeDialog}},[e._v(" 关闭")]),a("v-btn",{attrs:{color:"primary",text:"",disabled:!e.valid},on:{click:e.addHole}},[e._v(" 发送 ")])],1)],1)],1)],1)],1)},Wa=[],za=a("53ca"),Ga=(a("498a"),a("7db0"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{attrs:{id:this.contentName,name:"description"}})])}),Ya=[],Ja=a("ff41"),Xa=a.n(Ja),Ka=(a("2f2f"),function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){return Object(r["a"])(this,a),t.apply(this,arguments)}return Object(s["a"])(a,[{key:"validate",value:function(){return!!this.getContent()||(this.$emit("error","内容不能为空"),!1)}},{key:"getContent",value:function(){return this.editor.getValue()}},{key:"setContent",value:function(e){this.editor.setValue(e)}},{key:"mounted",value:function(){var e=this,t=ga.token;this.editor=new Xa.a(this.contentName,{height:360,placeholder:"说些什么......",toolbarConfig:{pin:!1},toolbar:["headings","bold","italic","strike","|","line","quote","list","code","|","emoji","link","upload",{name:"more",toolbar:["export","outline","preview","devtools","info","help"]}],icon:"material",cache:{enable:!0},counter:{enable:!0},hint:{},upload:{accept:"image/*",url:this.$feConfig.backEndApi+"images",headers:{Authorization:t||""},multiple:!1,fieldName:"image",linkToImgCallback:function(){console.log("api处理")},success:function(t,a){var n=JSON.parse(a).url;return e.editor.insertValue("![](".concat(n,")")),!0},error:function(t){console.log(t),e.$emit("error",t)}},after:function(){}})}},{key:"created",value:function(){}}]),a}(F));Object(u["a"])([Object(v["c"])({type:String})],Ka.prototype,"contentName",void 0),Ka=Object(u["a"])([v["a"]],Ka);var Qa=Ka,Za=Qa,en=Object(D["a"])(Za,Ga,Ya,!1,null,null,null),tn=en.exports,an=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.newcomer?a("v-dialog",{attrs:{persistent:"","max-width":"600px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[a("v-card",[a("v-card-title",[e._v(" 欢迎来到树洞")]),a("v-card-subtitle",{staticClass:"pt-2"},[e._v(" 玩得开心!")]),a("v-card-text",[a("ul",[a("li",{staticClass:"first-block"},[e._v(" 这是内部测试版本, 如有 bug 欢迎与开发团队联系 ")]),a("li",{staticClass:"first-block"},[e._v(" 匿名 "),a("ul",[a("li",[e._v("• 你会以一个随机的匿名ID发帖")]),a("li",[e._v("• 在同一个讨论帖中, 你拥有相同的匿名身份")]),a("li",[e._v(" • 在后续的版本更新中, 你将可以自由选择是否以匿名身份发帖 ")])])]),a("li",{staticClass:"first-block"},[e._v(" 安全 "),a("ul",[a("li",[e._v(" • 你的注册邮箱和密码已使用哈希算法加密, 即使网站的数据库被攻破也不会有人知道你的密码与真实身份 ")]),a("li",[e._v(" • 本站服务器位于中国香港特别行政区, 受当地法律保护。使用本树洞意味着你同意 "),a("router-link",{attrs:{to:"/license"}},[e._v("相关协议 ")])],1)])]),a("li",{staticClass:"first-block"},[e._v(" 友善 "),a("ul",[a("li",[e._v("• 没有人知道你是谁, 所以, 请友善地对待他人")])])])])]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"primary",text:""},on:{click:e.closeDialog}},[e._v(" 关闭")]),a("v-btn",{attrs:{color:"primary",text:""},on:{click:e.acceptDialog}},[e._v(" 接受")])],1)],1)],1):e._e()},nn=[],on=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.newcomer="",e.dialog=!0,e}return Object(s["a"])(a,[{key:"acceptDialog",value:function(){this.dialog=!1,localStorage.removeItem("newcomer")}},{key:"closeDialog",value:function(){this.dialog=!1,this.$router.replace("login")}},{key:"routeChanged",value:function(){var e=localStorage.getItem("newcomer");this.newcomer=e||""}}]),a}(F);Object(u["a"])([Object(v["e"])("$route",{immediate:!0})],on.prototype,"routeChanged",null),on=Object(u["a"])([v["a"]],on);var rn=on,sn=rn,ln=(a("7d1e"),a("169a")),cn=Object(D["a"])(sn,an,nn,!1,null,"c469fcec",null),un=cn.exports;oe()(cn,{VBtn:Pe["a"],VCard:rt["a"],VCardActions:st["a"],VCardSubtitle:st["b"],VCardText:st["c"],VCardTitle:st["d"],VDialog:ln["a"],VSpacer:xt["a"]});var dn=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{directives:[{name:"click-outside",rawName:"v-click-outside",value:e.clickOutside,expression:"clickOutside"}],staticStyle:{overflow:"visible"},attrs:{id:"hole-panel"}},[a("v-row",{staticClass:"ma-0",attrs:{justify:"center"}},[a("v-col",{staticClass:"mb-5 holelist",class:e.isActive?"holelist-left":"holelist-right",style:{marginTop:"-"+e.posY.toString()+"px"},on:{transitionend:e.onActivationEnd,wheel:e.scrollHoleListWhenActive}},[a("HoleList",{ref:"holeList",attrs:{activate:e.openHole,"display-hole-id":e.displayHoleId,"fix-card-height":e.isActive||!e.isEnd},on:{refresh:e.refresh}})],1),-1!==e.displayHoleId&&e.showFloorList?a("v-col",{staticClass:"mb-5",attrs:{cols:"5"}}):e._e(),a("v-col",{staticClass:"mb-5",attrs:{cols:"6"}},[-1!==e.displayHoleId&&e.showFloorList?a("FloorList",{key:e.displayHoleId,ref:"floorList",staticClass:"pa-0",attrs:{"display-floor-id":e.displayFloorId,"wrapped-hole-or-id":e.displayHole}}):e._e()],1)],1)],1)},hn=[],pn=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{staticClass:"pa-0",attrs:{id:"holeList"}},[a("animated-list",{ref:"animatedHoleList",attrs:{datas:e.holes,vkey:"holeIdStr"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.data,o=t.index;return[a("v-col",{staticClass:"py-2 px-1"},[a("HoleCard",{attrs:{hole:n,index:o,activate:e.activate,"is-active":n.holeId===e.displayHoleId,"fix-height":e.fixCardHeight}})],1)]}}])}),a("v-row",[a("v-col",[a("loading",{ref:"loading",attrs:{request:[e.getHoles],"pause-loading":e.pauseLoading}})],1)],1)],1)},vn=[],fn=(a("a434"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"rounded",class:e.isActive?"hole-card--active":"hole-card"},[a("v-card-actions",{staticClass:"pb-0 pt-2 pl-3 pr-3 font-weight-medium"},[a("span",e._l(e.hole.hole.tags,(function(e,t){return a("tag-chip",{key:t,attrs:{tag:e}})})),1)]),e.hole.isFolded?a("v-card-text",{staticClass:"folded-hint",attrs:{color:"grey"}},[e._v(" 该内容已折叠： "),a("span",{staticClass:"clickable",on:{click:function(t){e.hole.styleData.displayIt=!e.hole.styleData.displayIt}}},[e._v(" "+e._s(e.hole.styleData.displayIt?"收起":"展开")+" ")])]):e._e(),e.hole.styleData.displayIt?a("div",{staticClass:"post-content"},[a("v-card-text",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"text--primary py-2 text-body-1 clickable",on:{click:function(t){return e.activate(e.hole)}}},[e.hole.styleData.fold?a("div",{staticClass:"fold",style:e.fixHeight?"max-height: "+e.fixedHeight+";":"",attrs:{id:"p"+e.index}},[e._v(" "+e._s(e._f("plainText")(e.hole.firstFloor.content))+" ")]):a("div",{staticClass:"unfold",style:e.fixHeight?"max-height: "+e.fixedHeight+";":"",attrs:{id:"p"+e.index}},[a("div",{staticClass:"rich-text",domProps:{innerHTML:e._s(e.hole.firstFloor.html)}})])]),e.hole.styleData.lines>3&&e.isMobile?a("div",[e.hole.styleData.fold?a("div",[a("v-btn",{attrs:{text:"",block:"",depressed:"","x-small":"",color:"grey lighten-1"},on:{click:function(t){return e.unfold()}}},[a("v-icon",[e._v("mdi-chevron-double-down")])],1)],1):a("div",[a("v-btn",{attrs:{text:"",block:"",depressed:"","x-small":"",color:"grey lighten-1"},on:{click:function(t){return e.fold()}}},[a("v-icon",[e._v("mdi-chevron-double-up")])],1)],1)]):a("div",[a("div",{staticStyle:{height:"0.5rem"}})]),e.hole.firstFloor.floorId!==e.hole.lastFloor.floorId?a("v-card-text",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"clickable",on:{click:function(t){return e.activate(e.hole,e.hole.lastFloor.floorId,!0)}}},[a("v-row",{staticClass:"mx-0"},[a("span",{staticStyle:{width:"100%",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap",color:"rgba(19,13,10,0.83)"}},[e._v(" RE："+e._s(e._f("wordLimit")(e._f("plainText")(e.hole.lastFloor.content)))+" ")])])],1):e._e(),a("v-card-actions",{staticClass:"pt-0 pb-0 caption"},[a("span",[e._v("#"+e._s(e.hole.hole.holeId))]),a("v-spacer"),a("span",[e._v(e._s(e._f("timeDifference")(e.hole.hole.timeUpdated)))]),a("v-spacer"),a("span",[a("v-icon",{attrs:{small:""}},[e._v("mdi-message-processing-outline")]),e._v(" "+e._s(e.hole.hole.reply)+" ")],1)],1)],1):e._e()],1)}),mn=[],gn=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.fixedHeight="4.5rem",e}return Object(s["a"])(a,[{key:"calculateFixHeight",value:function(){var e=document.getElementById("p"+this.index);e&&(this.fixedHeight=window.getComputedStyle(e).height)}},{key:"onFixHeightChanged",value:function(){this.calculateFixHeight()}},{key:"mounted",value:function(){this.calculateFixHeight()}},{key:"unfold",value:function(){this.hole.styleData.fold=!1}},{key:"fold",value:function(){this.hole.styleData.fold=!0}}]),a}(F);Object(u["a"])([Object(v["c"])({required:!0})],gn.prototype,"hole",void 0),Object(u["a"])([Object(v["c"])({required:!0,type:Number})],gn.prototype,"index",void 0),Object(u["a"])([Object(v["c"])({required:!0,type:Function})],gn.prototype,"activate",void 0),Object(u["a"])([Object(v["c"])({required:!1,type:Boolean,default:!1})],gn.prototype,"isActive",void 0),Object(u["a"])([Object(v["c"])({type:Boolean,default:!1})],gn.prototype,"fixHeight",void 0),Object(u["a"])([Object(v["c"])({type:Boolean,default:!1})],gn.prototype,"pinned",void 0),Object(u["a"])([Object(v["e"])("fixHeight")],gn.prototype,"onFixHeightChanged",null),gn=Object(u["a"])([Object(v["a"])({components:{TagChip:se}})],gn);var bn=gn,yn=bn,kn=(a("1995"),a("269a")),On=a.n(kn),jn=a("5607"),wn=Object(D["a"])(yn,fn,mn,!1,null,"79dae434",null),xn=wn.exports;oe()(wn,{VBtn:Pe["a"],VCard:rt["a"],VCardActions:st["a"],VCardText:st["c"],VIcon:Ue["a"],VRow:na["a"],VSpacer:xt["a"]}),On()(wn,{Ripple:jn["a"]});a("e9c4");var Cn=a("45eb"),_n=a("7e84"),In=a("5c8a"),En=a("3a59"),Tn=function(){function e(){Object(r["a"])(this,e),this.datas=[]}return Object(s["a"])(e,[{key:"clear",value:function(){this.datas=[]}},{key:"pushData",value:function(e){this.datas.push(e)}}]),e}(),Vn=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(e){var n;return Object(r["a"])(this,a),n=t.call(this),n.loadedLength=0,n.datas=Object(In["a"])(e),n}return Object(s["a"])(a,[{key:"clear",value:function(){Object(Cn["a"])(Object(_n["a"])(a.prototype),"clear",this).call(this),this.loadedLength=0}},{key:"pushData",value:function(e,t,a){void 0===t||t>=this.loadedLength?this.loadedLength===this.datas.length?(this.datas.push(e),this.loadedLength++):a&&a(e,this.datas[this.loadedLength])?n["default"].set(this.datas,this.loadedLength++,e):this.datas[this.loadedLength++]=e:a&&a(e,this.datas[t])?n["default"].set(this.datas,t,e):this.datas[t]=e}}]),a}(Tn),$n=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.tag=null,e.pinCount=0,e}return Object(s["a"])(a,[{key:"requestHole",value:function(){var e=Object(H["a"])(regeneratorRuntime.mark((function e(t){var a,n,o=this,i=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:0,e.next=3,null===(a=pe.$axios)||void 0===a?void 0:a.get("/holes/".concat(t)).then((function(e){var t=new he(Y(e.data));o.datas.splice(n,0,t)})).catch((function(e){throw new Error(e)}));case 3:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"pushFront",value:function(e){Object(En["a"])(this.datas,(function(t){return t.holeId===e.holeId})),this.datas.splice(0,0,e)}},{key:"pin",value:function(e){this.pushFront(e),this.pinCount++}},{key:"pushData",value:function(e){var t=!1;this.datas.forEach((function(a){a.hole.holeId===e.hole.holeId&&(t=!0)})),t||Object(Cn["a"])(Object(_n["a"])(a.prototype),"pushData",this).call(this,e)}}]),a}(Tn),Sn=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.startTime=new Date,e}return Object(s["a"])(a,[{key:"clear",value:function(){Object(Cn["a"])(Object(_n["a"])(a.prototype),"clear",this).call(this),this.startTime=new Date}},{key:"request",value:function(){var e=Object(H["a"])(regeneratorRuntime.mark((function e(){var t,a,n,o=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=!1,n={start_time:this.startTime.toISOString(),length:10,prefetch_length:10,division_id:1},this.tag&&(n.tag=this.tag.name),e.next=5,null===(t=pe.$axios)||void 0===t?void 0:t.get("/holes",{params:n}).then((function(e){e.data.forEach((function(e){if(e.floors.first_floor&&e.floors.last_floor&&!(e.reply<0)){var t=new he(Y(e));o.pushData(t),a=!0}})),o.datas.length>0&&(o.startTime=new Date(o.datas[o.datas.length-1].hole.timeUpdated))})).catch((function(e){throw new Error(e)}));case 5:return e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),a}($n),Dn=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(e){var n;return Object(r["a"])(this,a),n=t.call(this),n.startTime=new Date,n.divisionId=e,n}return Object(s["a"])(a,[{key:"clear",value:function(){Object(Cn["a"])(Object(_n["a"])(a.prototype),"clear",this).call(this),this.startTime=new Date}},{key:"request",value:function(){var e=Object(H["a"])(regeneratorRuntime.mark((function e(){var t,a,n,o=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=!1,n={start_time:this.startTime.toISOString(),length:10,prefetch_length:10,division_id:this.divisionId},this.tag&&(n.tag=this.tag.name),e.next=5,null===(t=pe.$axios)||void 0===t?void 0:t.get("/holes",{params:n}).then((function(e){e.data.forEach((function(e){if(e.floors.first_floor&&e.floors.last_floor&&!(e.reply<0)){var t=new he(Y(e));o.pushData(t),a=!0}})),o.datas.length>0&&(o.startTime=new Date(o.datas[o.datas.length-1].hole.timeUpdated))})).catch((function(e){throw new Error(e)}));case 5:return e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),a}($n),Mn=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){return Object(r["a"])(this,a),t.apply(this,arguments)}return Object(s["a"])(a,[{key:"request",value:function(){var e=Object(H["a"])(regeneratorRuntime.mark((function e(){var t,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,null===(t=pe.$axios)||void 0===t?void 0:t.get("/user/favorites").then((function(e){e.data.forEach((function(e){if(e.floors.first_floor&&e.floors.last_floor&&!(e.reply<0)){var t=new he(Y(e));a.pushData(t)}}))})).catch((function(e){throw new Error(e)}));case 2:return e.abrupt("return",!1);case 3:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()}]),a}($n),Fn=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(e){var n;return Object(r["a"])(this,a),n=t.call(this),n.searchStr=e,n}return Object(s["a"])(a,[{key:"request",value:function(){var e=Object(H["a"])(regeneratorRuntime.mark((function e(){var t,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,null===(t=pe.$axios)||void 0===t?void 0:t.get("/floors",{params:{s:this.searchStr}}).then((function(e){e.data.forEach((function(e){var t=new ue(Y(e));a.pushData(t)}))}));case 2:return e.abrupt("return",!1);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),a}(Tn),Rn=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(e,n,o){var i;return Object(r["a"])(this,a),i=t.call(this,e),i.holeId=n,i.renderFloor=o,i}return Object(s["a"])(a,[{key:"request",value:function(){var e=Object(H["a"])(regeneratorRuntime.mark((function e(){var t,a,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=!1,e.next=3,null===(t=pe.$axios)||void 0===t?void 0:t.get("/floors",{params:{hole_id:this.holeId,start_floor:this.loadedLength,length:10}}).then((function(e){var t=e.config.params.start_floor;e.data.forEach((function(e){var o=new de(Y(e));n.renderFloor(o),n.pushData(o,t++,(function(){return!0})),a=!0}))}));case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),a}(Vn),Ln=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.holes=[],e.startTime=new Date,e.collectionIds=[],e.lineHeight=10,e.pauseLoading=!0,e}return Object(s["a"])(a,[{key:"refresh",value:function(){this.request.clear(),this.holes=this.request.datas,this.loading.continueLoad(),this.pin()}},{key:"isPinned",value:function(e){for(var t=0;t<this.request.pinCount;t++)if(this.holes[t].holeId===e)return!0;return!1}},{key:"calculateLines",value:function(){for(var e=0;e<this.holes.length;e++){var t,a=document.getElementById("p"+e),n=null!==(t=null===a||void 0===a?void 0:a.scrollHeight)&&void 0!==t?t:0;this.holes[e].styleData.lines=n/this.lineHeight}}},{key:"getHoles",value:function(){var e=Object(H["a"])(regeneratorRuntime.mark((function e(){var t,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=!1,e.next=3,this.request.request().then((function(e){t=e})).catch((function(e){console.log(e),void 0===e.response?a.messageError(JSON.stringify(e)):a.messageError(e.response.data.msg)}));case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"onGotoMentionFloor",value:function(e,t){}},{key:"holesChanged",value:function(){var e=this;setTimeout((function(){var t=document.getElementById("p1");e.lineHeight=t?parseInt(window.getComputedStyle(t,null).getPropertyValue("line-height")):10,e.calculateLines()}),100)}},{key:"mounted",value:function(){var e=this;window.addEventListener("resize",(function(){e.debouncedCalculateLines()})),I.$on("goto-mention-floor",this.onGotoMentionFloor)}},{key:"destroyed",value:function(){ge.collection.unregisterUpdateHoleArray(this.$route.name),I.$off("goto-mention-floor",this.onGotoMentionFloor)}},{key:"divisionId",get:function(){return"division"===this.route?parseInt(this.$route.params.id):1}},{key:"getDivisionById",value:function(e){var t=null;return ge.divisions.forEach((function(a){a.divisionId===e&&(t=a)})),t}},{key:"pin",value:function(){var e=this.getDivisionById(this.divisionId);if(e&&(this.request instanceof Sn||this.request instanceof Dn))for(var t=e.pinned.length-1;t>=0;t--)this.request.pin(new he(e.pinned[t]))}},{key:"onPreloaded",value:function(){var e=Object(H["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.pin(),this.pauseLoading=!1,e.next=4,this.$nextTick();case 4:this.loading.continueLoad();case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"created",value:function(){this.route=this.$route.name,ge.collection.getCollections(),this.debouncedCalculateLines=Object(Ra["a"])(this.calculateLines,300),"home"===this.route?this.request=new Sn:"collections"===this.route?this.request=new Mn:"division"===this.route&&(this.request=new Dn(this.divisionId)),this.holes=this.request.datas,ge.collection.registerUpdateHoleArray(this.route,this.holes)}},{key:"filtedTagMapChanged",value:function(){this.request.tag=this.filtedTagMap[this.route]?this.filtedTagMap[this.route]:null,this.$emit("refresh")}}]),a}(F);Object(u["a"])([Object(v["d"])()],Ln.prototype,"loading",void 0),Object(u["a"])([Object(v["e"])("holes")],Ln.prototype,"holesChanged",null),Object(u["a"])([Object(v["e"])("filtedTagMap",{deep:!0})],Ln.prototype,"filtedTagMapChanged",null),Ln=Object(u["a"])([v["a"]],Ln);var Hn,An,qn=Ln,Bn=qn,Nn=Object(D["a"])(Bn,Hn,An,!1,null,null,null),Pn=Nn.exports,Un=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-row",{directives:[{name:"intersect",rawName:"v-intersect",value:{handler:e.onIntersect,options:{threshold:[0,.2]}},expression:"{\n    handler: onIntersect,\n    options: { threshold: [0,0.2] },\n  }"}],staticClass:"py-4"},[a("v-col",{staticClass:"text-center"},[a("v-progress-linear",{attrs:{active:e.isLoading||e.pauseLoading,indeterminate:"",absolute:"",top:"",color:"teal"}}),e.isLoading||e.pauseLoading?a("div",[a("v-progress-circular",{attrs:{indeterminate:"",color:"teal"}})],1):e._e(),e.hasNext||e.isLoading||e.pauseLoading?e._e():a("div",[e._v("没有然后了......")])],1)],1)},Wn=[],zn=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.hasNext=!0,e.isLoading=!1,e}return Object(s["a"])(a,[{key:"onIntersect",value:function(e){var t=this;e[0].isIntersecting&&this.load().catch((function(e){console.log(e),void 0===e.response?t.messageError(JSON.stringify(e)):t.messageError(e.response.data.msg)}))}},{key:"load",value:function(){var e=Object(H["a"])(regeneratorRuntime.mark((function e(){var t,a=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:0,this.hasNext&&!this.pauseLoading&&0!==this.request.length){e.next=3;break}return e.abrupt("return");case 3:return this.isLoading=!0,e.next=6,this.request[t]();case 6:this.hasNext=e.sent,this.isLoading=!1;case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadOnce",value:function(){var e=Object(H["a"])(regeneratorRuntime.mark((function e(){var t,a=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:0,!this.pauseLoading){e.next=4;break}return console.error("Try to load when loading is paused."),e.abrupt("return");case 4:return this.isLoading=!0,e.next=7,this.request[t]();case 7:this.hasNext=e.sent,this.isLoading=!1;case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadCustomRequestOnce",value:function(){var e=Object(H["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.pauseLoading){e.next=3;break}return console.error("Try to load when loading is paused."),e.abrupt("return");case 3:return this.isLoading=!0,e.next=6,t();case 6:this.isLoading=!1;case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"continueLoad",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.isLoading||(this.hasNext=!0,this.load(e))}}]),a}(F);Object(u["a"])([Object(v["c"])({required:!0,type:Array})],zn.prototype,"request",void 0),Object(u["a"])([Object(v["c"])({required:!1,type:Boolean,default:!1})],zn.prototype,"pauseLoading",void 0),zn=Object(u["a"])([v["a"]],zn);var Gn=zn,Yn=Gn,Jn=a("490a"),Xn=a("8e36"),Kn=a("90a2"),Qn=Object(D["a"])(Yn,Un,Wn,!1,null,null,null),Zn=Qn.exports;oe()(Qn,{VCol:qa["a"],VProgressCircular:Jn["a"],VProgressLinear:Xn["a"],VRow:na["a"]}),On()(Qn,{Intersect:Kn["a"]});var eo=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{staticClass:"pa-0 mb-3"},e._l(e.computedDatas,(function(t,n){return a("v-row",{key:t.data[e.vkey],class:t.class,attrs:{id:"animated-"+t.data[e.vkey]}},[e._t("default",null,{data:t.data,index:n})],2)})),1)},to=[],ao=a("1209"),no=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.computedDatas=[],e.intermediateDatas=[],e.animating=!1,e.animatingCount=0,e.completeCount=0,e.computedHeight=new Map,e.currentTop=new Map,e.updatedTop=new Map,e}return Object(s["a"])(a,[{key:"generateComputedData",value:function(){var e=[];return this.intermediateDatas.forEach((function(t){e.push({data:t,class:""})})),e}},{key:"measureHeight",value:function(){var e=this;this.computedDatas.forEach((function(t){var a=document.getElementById("animated-"+t.data[e.vkey]);if(a){var n=parseInt(window.getComputedStyle(a).height);e.computedHeight.set(t.data[e.vkey],n)}}))}},{key:"measureCurrentTop",value:function(){var e=this,t=0;this.currentTop=new Map,this.computedDatas.forEach((function(a){e.currentTop.set(a.data[e.vkey],t);var n=e.computedHeight.get(a.data[e.vkey]);if(!n)throw new Error("Computed Height Not Found!");t+=n}))}},{key:"measureUpdatedTop",value:function(){var e=this,t=0;this.updatedTop=new Map,this.intermediateDatas.forEach((function(a){e.updatedTop.set(a[e.vkey],t);var n=e.computedHeight.get(a[e.vkey]);if(!n)throw new Error("Computed Height Not Found!");t+=n}))}},{key:"getComputedDatasFromKey",value:function(e){var t=this,a=null;return this.computedDatas.forEach((function(n){n.data[t.vkey]===e&&(a=n)})),a}},{key:"finishAnimation",value:function(){this.animating=!1,this.updateData()}},{key:"complete",value:function(){this.completeCount++,this.completeCount===this.animatingCount&&(this.computedDatas=this.generateComputedData(),this.finishAnimation())}},{key:"isDataUpToDate",value:function(){if(this.intermediateDatas.length!==this.datas.length)return!1;for(var e=0;e<this.intermediateDatas.length&&e<this.datas.length;e++)if(this.intermediateDatas[e]!==this.datas[e])return!1;return!0}},{key:"updateData",value:function(){this.isDataUpToDate()||(this.intermediateDatas=this.datas.map((function(e){return e})))}},{key:"datasChanged",value:function(){this.animating||this.updateData()}},{key:"intermediateDatasChanged",value:function(){var e=Object(H["a"])(regeneratorRuntime.mark((function e(){var t,a,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.intermediateDatas&&0!==this.intermediateDatas.length){e.next=3;break}return this.computedDatas=[],e.abrupt("return");case 3:t=!0,a=0;case 5:if(!(a<this.computedDatas.length)){e.next=12;break}if(this.intermediateDatas[a]&&this.computedDatas[a].data===this.intermediateDatas[a]){e.next=9;break}return t=!1,e.abrupt("break",12);case 9:a++,e.next=5;break;case 12:return this.intermediateDatas.forEach((function(e){null===n.getComputedDatasFromKey(e[n.vkey])&&n.computedDatas.push({data:e,class:"invisible"})})),e.next=15,this.$nextTick();case 15:this.measureHeight(),this.measureCurrentTop(),this.measureUpdatedTop(),this.completeCount=0,this.computedDatas.length>0&&(this.animating=!0,this.animatingCount=this.computedDatas.length),this.computedDatas.forEach((function(e){var a=n.currentTop.get(e.data[n.vkey]),o=n.updatedTop.get(e.data[n.vkey]);if(void 0===a)throw new Error("Cannot Get From Data!");if(void 0!==o){var i=ao["a"].timeline({targets:document.getElementById("animated-"+e.data[n.vkey])});t||i.add({translateY:o-a,duration:900}),"invisible"===e.class&&i.add({translateX:-100,duration:0}),i.add({translateX:0,opacity:1,duration:550,easing:"cubicBezier(0.385, 0.900, 0.570, 1.010)"},"+=50"),i.finished.then((function(){n.complete();var t=document.getElementById("animated-"+e.data[n.vkey]);t&&(ao["a"].remove(t),t.removeAttribute("style"))}))}else Object(ao["a"])({targets:document.getElementById("animated-"+e.data[n.vkey]),opacity:0,translateX:100,duration:550,easing:"cubicBezier(0.385, 0.900, 0.570, 1.010)"}).finished.then((function(){n.complete()}))}));case 21:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),a}(F);Object(u["a"])([Object(v["c"])({required:!0,type:Array})],no.prototype,"datas",void 0),Object(u["a"])([Object(v["c"])({required:!0,type:String})],no.prototype,"vkey",void 0),Object(u["a"])([Object(v["e"])("datas")],no.prototype,"datasChanged",null),Object(u["a"])([Object(v["e"])("intermediateDatas",{immediate:!0})],no.prototype,"intermediateDatasChanged",null),no=Object(u["a"])([v["a"]],no);var oo=no,io=oo,ro=(a("5b57"),Object(D["a"])(io,eo,to,!1,null,"d1e69aee",null)),so=ro.exports;oe()(ro,{VContainer:Ba["a"],VRow:na["a"]});var lo=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){return Object(r["a"])(this,a),t.apply(this,arguments)}return Object(s["a"])(a,[{key:"getHeight",value:function(){var e=document.getElementById("holeList");return e?parseInt(window.getComputedStyle(e).height):0}},{key:"onGotoMentionFloor",value:function(e,t){var a,n;this.isPinned(e.holeId)?this.openNewOrExistHole(t.holeId,t.floorId):(this.holes.forEach((function(t,o){t.hole.holeId===e.holeId&&(a=t,n=o)})),void 0!==a&&void 0!==n?this.openNewOrExistHole(t.holeId,t.floorId,n):console.error("Current Hole Not Found!"))}},{key:"openNewOrExistHole",value:function(e,t){var a,n,o=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.request.pinCount;this.holes.forEach((function(t,o){t.hole.holeId===e&&(a=t,n=o)})),void 0===a||void 0===n?this.loading.loadCustomRequestOnce(Object(H["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",o.request.requestHole(e,i));case 1:case"end":return t.stop()}}),t)})))).then((function(){a=o.holes[i],t?o.activate(a,t,!0):o.activate(a)})):(this.isPinned(e)||n===i||(this.holes.splice(n,1),this.holes.splice(n>i?i:i-1,0,a)),t?this.activate(a,t,!0):this.activate(a))}},{key:"mounted",value:function(){I.$on("goto-hole",this.openNewOrExistHole)}},{key:"destroyed",value:function(){I.$off("goto-hole",this.openNewOrExistHole)}}]),a}(Pn);Object(u["a"])([Object(v["c"])({required:!0,type:Function})],lo.prototype,"activate",void 0),Object(u["a"])([Object(v["c"])({required:!1,type:Number,default:-1})],lo.prototype,"displayHoleId",void 0),Object(u["a"])([Object(v["c"])({type:Boolean,default:!1})],lo.prototype,"fixCardHeight",void 0),Object(u["a"])([Object(v["d"])()],lo.prototype,"animatedHoleList",void 0),lo=Object(u["a"])([Object(v["a"])({components:{HoleCard:xn,Loading:Zn,AnimatedList:so}})],lo);var co=lo,uo=co,ho=Object(D["a"])(uo,pn,vn,!1,null,null,null),po=ho.exports;oe()(ho,{VCol:qa["a"],VContainer:Ba["a"],VRow:na["a"]});var vo=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",["hole"!==this.$route.name||this.initiating?e._e():a("v-card",{staticClass:"mt-n2 mx-n2 mb-3",attrs:{"max-width":"700px"}},[a("v-card-text",{staticClass:"text--primary pb-2 pt-2 font-weight-medium"},e._l(e.hole.hole.tags,(function(t,n){return a("v-chip",{key:n,staticClass:"ma-1",attrs:{color:"red",outlined:"",ripple:""}},[e._v(" "+e._s(t.name)+" ")])})),1),a("v-divider"),a("v-card-text",{staticClass:"text--primary pt-2 pb-2 text-center"},[a("span",{staticStyle:{float:"left"}},[e._v("#"+e._s(e.hole.hole.holeId))]),a("span",{staticStyle:{float:"inherit"}},[e._v(e._s(e._f("timeDifference")(e.hole.hole.timeUpdated)))]),a("span",{staticStyle:{float:"right"}},[e._v(" "+e._s(e.hole.hole.reply)+" "),a("v-icon",{attrs:{small:""}},[e._v("mdi-message-processing-outline")])],1)])],1),a("transition-group",{attrs:{name:"slide-fade"}},e._l(e.floors,(function(t,n){return a("v-row",{directives:[{name:"viewer",rawName:"v-viewer"}],key:""+n,attrs:{justify:"center"}},[a("v-col",{class:e.colClass},[a("FloorCard",{attrs:{floor:t,index:n},on:{reply:function(a){return e.reply(t.floorId)},edit:function(a){return e.edit(t.floorId)}}})],1)],1)})),1),e.initiating?e._e():a("div",{staticClass:"float-btn"},[a("v-dialog",{attrs:{persistent:"","max-width":"600px"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,o=t.attrs;return[a("v-btn",e._g(e._b({attrs:{fab:"",color:"secondary"},on:{mousedown:function(e){e.preventDefault()}}},"v-btn",o,!1),n),[a("v-icon",[e._v("mdi-send")])],1)]}}],null,!1,925447242),model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[a("v-card",[a("v-card-title",[a("span",{staticClass:"headline"},[e._v("发表回复")])]),a("v-card-text",[e.replyFloor?a("Mention",{attrs:{"mention-floor":e.replyFloor,cancel:e.removeReplyFloor}}):e._e(),a("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[a("editor",{ref:"editor",attrs:{contentName:e.contentName},on:{error:e.editorError}})],1)],1),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"primary",text:""},on:{click:e.closeDialog}},[e._v(" 关闭")]),"reply"===e.operation||"add"===e.operation?a("v-btn",{attrs:{color:"primary",text:"",disabled:!e.valid},on:{click:e.addFloor}},[e._v(" 发送 ")]):"edit"===e.operation?a("v-btn",{attrs:{color:"primary",text:"",disabled:!e.valid},on:{click:e.editFloor}},[e._v(" 修改 ")]):e._e()],1)],1)],1),a("br"),a("v-btn",{attrs:{fab:"",color:"secondary"},on:{mousedown:function(e){e.preventDefault()},click:e.changeCollectionStatus}},[a("v-icon",{class:e.hole.isStarred?"v-icon--starred":""},[e._v("mdi-star")])],1)],1),a("loading",{ref:"loading",attrs:{request:[e.getFloors],"pause-loading":e.initiating}})],1)},fo=[],mo=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.floors=[],e.loadedLength=0,e.replyFloor=null,e.dialog=!1,e.operation="add",e.editingFloorId=0,e.requiredRules=[function(e){return!!e||"内容不能为空"}],e.valid=!0,e}return Object(s["a"])(a,[{key:"computedDiscussionId",get:function(){return-1}},{key:"editorError",value:function(e){this.messageError(e)}},{key:"closeDialog",value:function(){this.dialog=!1,this.replyFloor=null,this.operation="add"}},{key:"refresh",value:function(){this.request.clear(),this.floors=this.request.datas,this.loading.continueLoad()}},{key:"getIndex",value:function(e){for(var t=0;t<this.floors.length;t++)if(this.floors[t].floorId===e)return t;return-1}},{key:"reply",value:function(e){this.replyFloor=this.floors[this.getIndex(e)],this.operation="reply",this.dialog=!0}},{key:"edit",value:function(e){var t=this.floors[this.getIndex(e)];t instanceof de&&t.mention[0]&&(this.replyFloor=new ue(t.mention[0])),this.operation="edit",this.editingFloorId=e,this.dialog=!0}},{key:"removeReplyFloor",value:function(){this.replyFloor=null}},{key:"getDiscussion",value:function(){var e=Object(H["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$axios.get("/holes/"+t);case 3:a=e.sent,a.data&&(this.hole=new he(Y(a.data))),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),void 0===e.t0.response?this.messageError(JSON.stringify(e.t0)):this.messageError(e.t0.response.data.msg);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"changeCollectionStatus",value:function(){var e=this;this.hole.isStarred?this.$axios.delete("/user/favorites",{data:{hole_id:this.hole.hole.holeId}}).then((function(t){e.messageSuccess(t.data.message),ge.collection.setCollection(t.data.data)})).catch((function(t){e.messageError(t.response.data.msg),e.hole.isStarred=!e.hole.isStarred})):this.$axios.post("/user/favorites",{hole_id:this.hole.hole.holeId}).then((function(t){e.messageSuccess(t.data.message),ge.collection.setCollection(t.data.data)})).catch((function(t){e.messageError(t.response.data.msg),e.hole.isStarred=!e.hole.isStarred})),this.hole.isStarred=!this.hole.isStarred}},{key:"getFloors",value:function(){var e=Object(H["a"])(regeneratorRuntime.mark((function e(){var t,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.request){e.next=2;break}return e.abrupt("return",!1);case 2:return t=!1,e.next=5,this.request.request().then((function(e){t=e})).catch((function(e){void 0===e.response?a.messageError(JSON.stringify(e)):a.messageError(e.response.data.msg)}));case 5:return e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"addFloor",value:function(){var e=this;if(this.form.validate()&&this.editor.validate()){this.dialog=!1;var t=this.loading,a=this.editor,n=(this.replyFloor?"#"+this.replyFloor.floorId+"\n\n":"")+this.editor.getContent(),o=[];n.replace(/(^|\s)#(\w+)/g,(function(e,t,a){return o.push(parseInt(a)),e})),this.$axios.post("/floors",{content:n,hole_id:this.computedDiscussionId,mention:o}).then((function(n){e.messageSuccess(n.data.message),t.continueLoad(),e.replyFloor=null,a.setContent("")})).catch((function(t){console.log(t),e.messageError(t)}))}}},{key:"editFloor",value:function(){var e=this;if(this.form.validate()&&this.editor.validate()){this.dialog=!1;var t=this.editor,a=(this.replyFloor?"#"+this.replyFloor.floorId+"\n\n":"")+this.editor.getContent(),o=[];a.replace(/(^|\s)#(\w+)/g,(function(e,t,a){return o.push(parseInt(a)),e})),this.$axios.put("/floors/".concat(this.editingFloorId),{content:a,mention:o}).then((function(a){e.messageSuccess("修改成功");var o=new de(Y(a.data));e.renderFloor(o),e.checkAndRerenderFloors(o),n["default"].set(e.floors,e.getIndex(o.floorId),o),e.replyFloor=null,t.setContent("")})).catch((function(t){console.log(t),e.messageError(t)}))}}},{key:"checkAndRerenderFloors",value:function(e){var t=this;this.floors.forEach((function(a,o){if(a instanceof de&&0!==a.mention.length){for(var i=!1,r=0;r<a.mention.length;r++)a.mention[r].floorId===e.floorId&&(a.mention[r]=e,i=!0);i&&(a.html+=" ",t.renderFloor(a),n["default"].set(t.floors,o,a))}}))}},{key:"renderFloor",value:function(){var e=Object(H["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Vt(t,this);case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"mounted",value:function(){-1!==this.displayFloorId&&X(0,this.getIndex(this.displayFloorId))}},{key:"contentName",get:function(){return"discussion-"+this.computedDiscussionId+"-content"}}]),a}(F);Object(u["a"])([Object(v["c"])({type:Number,default:-1})],mo.prototype,"displayFloorId",void 0),Object(u["a"])([Object(v["d"])()],mo.prototype,"form",void 0),Object(u["a"])([Object(v["d"])()],mo.prototype,"editor",void 0),Object(u["a"])([Object(v["d"])()],mo.prototype,"loading",void 0),mo=Object(u["a"])([v["a"]],mo);var go,bo,yo=mo,ko=yo,Oo=Object(D["a"])(ko,go,bo,!1,null,null,null),jo=Oo.exports,wo=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.initiating=!0,e}return Object(s["a"])(a,[{key:"computedDiscussionId",get:function(){return this.wrappedHoleOrId instanceof he?this.wrappedHoleOrId.hole.holeId:this.wrappedHoleOrId}},{key:"colClass",get:function(){return this.isMobile?"px-1 py-1":"px-1 py-2"}},{key:"tryScrollTo",value:function(e,t,a,n){var o=this;setTimeout((function(){document.getElementById(e.toString())&&document.getElementById(t.toString())?X(e,t):o.tryScrollTo(e,t,a-1,n)}),n)}},{key:"getFloorsRecursive",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this.loading.load().then((function(){var a=!1;if(-1!==t)for(var n=0;n<e.request.loadedLength;n++)if(e.floors[n].floorId===t){e.tryScrollTo(0,n,5,350),a=!0;break}e.loading.hasNext&&(-1===t||a?e.getFloorsRecursive():e.getFloorsRecursive(t))}))}},{key:"init",value:function(e){var t=this;this.request=new Rn(this.hole.floors,this.computedDiscussionId,this.renderFloor),this.floors=this.request.datas,this.initiating=!1,this.$nextTick((function(){return t.getFloorsRecursive(e)}))}},{key:"mounted",value:function(){var e=this;this.wrappedHoleOrId instanceof he?(this.hole=this.wrappedHoleOrId,this.init(this.displayFloorId)):this.getDiscussion(this.wrappedHoleOrId).then((function(){e.init(e.displayFloorId)}))}},{key:"updated",value:function(){kt.a.highlightAll()}}]),a}(jo);Object(u["a"])([Object(v["c"])({required:!0})],wo.prototype,"wrappedHoleOrId",void 0),wo=Object(u["a"])([Object(v["a"])({components:{Mention:_t,Loading:Zn,Editor:tn,FloorCard:dt}})],wo);var xo=wo,Co=xo,_o=(a("89a1"),Object(D["a"])(Co,vo,fo,!1,null,"04cf9d34",null)),Io=_o.exports;oe()(_o,{VBtn:Pe["a"],VCard:rt["a"],VCardActions:st["a"],VCardText:st["c"],VCardTitle:st["d"],VChip:ie["a"],VCol:qa["a"],VContainer:Ba["a"],VDialog:ln["a"],VDivider:At["a"],VForm:Qt["a"],VIcon:Ue["a"],VRow:na["a"],VSpacer:xt["a"]});var Eo=a("cffa"),To=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.isActive=!1,e.isEnd=!0,e.showFloorList=!1,e.displayHoleId=-1,e.posY=0,e.marginTopY=0,e.viewport=0,e.isLoadingVisible=!1,e.displayHole=null,e.displayFloorId=-1,e}return Object(s["a"])(a,[{key:"refresh",value:function(){this.deactivate(),this.holeList.refresh(),this.resetScrollTop()}},{key:"openHole",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.displayHole=e,this.isActive&&a&&this.displayHoleId===e.hole.holeId||this.activate(e.hole.holeId),t?(this.displayFloorId=t,this.showFloorList&&a&&this.displayHoleId===e.hole.holeId&&this.floorList.tryScrollTo(0,this.floorList.getIndex(t),5,350)):this.displayFloorId=-1}},{key:"activate",value:function(e){this.isActive||(this.isActive=!0,this.isEnd=!1),this.displayHoleId!==e?(this.displayHoleId=e,document.body.scrollTop=document.documentElement.scrollTop=0):(this.displayHoleId=-1,this.showFloorList=!1,this.isActive=!1,this.isEnd=!1)}},{key:"onActivationEnd",value:function(e){"transform"===e.propertyName&&(this.isEnd=!0,this.isActive&&(document.body.scrollTop=document.documentElement.scrollTop=0,this.showFloorList=!0))}},{key:"resetScrollTop",value:function(){this.marginTopY=this.posY=0}},{key:"scrollHoleList",value:function(e){var t=.7;this.marginTopY=this.marginTopY>-e.deltaY*t?this.marginTopY+e.deltaY*t:0;var a=this.holeList.getHeight();this.marginTopY+this.viewport>a+200&&(this.marginTopY=a-this.viewport+200)}},{key:"wheelListener",value:function(e){!this.isActive&&this.isEnd&&this.scrollHoleList(e)}},{key:"scrollHoleListWhenActive",value:function(e){!this.isActive&&this.isEnd||(e.preventDefault(),this.scrollHoleList(e))}},{key:"deactivate",value:function(){-1!==this.displayHoleId&&this.activate(this.displayHoleId)}},{key:"clickOutside",value:function(e){if(e.path&&5!==e.path.length&&e.path[0].className.includes("main")){for(var t=!0,a=0;a<e.path.length;a++)e.path[a].className&&e.path[a].className.includes&&(e.path[a].className.includes("navbar")||e.path[a].className.includes("dialog")||e.path[a].className.includes("overlay"))&&(t=!1);t&&this.deactivate()}}},{key:"mounted",value:function(){var e=this,t=document.getElementsByClassName("v-main__wrap").item(0);t instanceof HTMLElement&&t.addEventListener("wheel",this.wheelListener),this.viewport=window.innerHeight,window.addEventListener("resize",(function(){e.viewport=window.innerHeight}))}},{key:"destroyed",value:function(){var e=document.getElementsByClassName("v-main__wrap").item(0);e instanceof HTMLElement&&e.removeEventListener("wheel",this.wheelListener)}},{key:"showFloorListChanged",value:function(e){}},{key:"marginTopYChanged",value:function(e){Eo["a"].to(this.$data,{duration:.2,posY:e})}}]),a}(F);Object(u["a"])([Object(v["d"])()],To.prototype,"holeList",void 0),Object(u["a"])([Object(v["d"])()],To.prototype,"floorList",void 0),Object(u["a"])([Object(v["e"])("showFloorList"),Object(v["b"])()],To.prototype,"showFloorListChanged",null),Object(u["a"])([Object(v["e"])("marginTopY")],To.prototype,"marginTopYChanged",null),To=Object(u["a"])([Object(v["a"])({components:{FloorList:Io,HoleList:po}})],To);var Vo=To,$o=Vo,So=(a("a378"),a("a293")),Do=Object(D["a"])($o,dn,hn,!1,null,null,null),Mo=Do.exports;oe()(Do,{VCol:qa["a"],VContainer:Ba["a"],VRow:na["a"]}),On()(Do,{ClickOutside:So["a"]});var Fo=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{staticClass:"pa-0"},[e._l(e.holes,(function(t,n){return a("v-row",{key:n,staticClass:"ma-0",attrs:{justify:"center"}},[a("v-col",{staticClass:"py-1 px-1",attrs:{cols:"12"}},[a("HoleCard",{attrs:{hole:t,index:n,activate:e.toDiscussion},on:{refresh:e.refresh}})],1)],1)})),a("loading",{ref:"loading",attrs:{request:[e.getHoles],"pause-loading":e.pauseLoading}})],2)},Ro=[],Lo=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){return Object(r["a"])(this,a),t.apply(this,arguments)}return Object(s["a"])(a,[{key:"toDiscussion",value:function(e,t){var a=this;setTimeout((function(){t?a.$router.push({path:"/hole/".concat(e.hole.holeId),query:{mention:t.toString()}}):a.$router.push({path:"/hole/".concat(e.hole.holeId)})}),50)}},{key:"onGotoMentionFloor",value:function(e,t){this.$router.push({path:"/hole/".concat(t.holeId),query:{mention:t.floorId.toString()}})}}]),a}(Pn);Lo=Object(u["a"])([Object(v["a"])({components:{HoleCard:xn,Loading:Zn}})],Lo);var Ho=Lo,Ao=Ho,qo=Object(D["a"])(Ao,Fo,Ro,!1,null,null,null),Bo=qo.exports;oe()(qo,{VCol:qa["a"],VContainer:Ba["a"],VRow:na["a"]});var No=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.lineHeight=0,e.scrollTop=0,e.content="",e.tags=[],e.selectedTags=[],e.selectedDivision={divisionId:0,description:"",name:"",pinned:[]},e.dialog=!1,e.tagRules=[function(e){return e.length<=5||"标签不能多于5个"},function(e){return e.length>=1||"请至少选择1个标签"}],e.contentRules=[function(e){return!!e.trim()||"内容不能为空"}],e.errorMsg={},e.valid=!0,e.params={},e.showFloatBtn=!0,e}return Object(s["a"])(a,[{key:"contentName",get:function(){return"home-content"}},{key:"divisions",get:function(){return ge.divisions}},{key:"reload",value:function(){var e;this.clearTag(null!==(e=this.$route.name)&&void 0!==e?e:void 0),this.holeComp.refresh()}},{key:"editorError",value:function(e){this.messageError(e)}},{key:"openDialog",value:function(){this.getTags(),this.selectedDivision=ge.divisions[0]}},{key:"closeDialog",value:function(){this.dialog=!1,this.errorMsg={},this.valid=!0}},{key:"addHole",value:function(){var e=this;this.form.validate()&&this.editor.validate()&&(this.closeDialog(),this.$axios.post("/holes",{content:this.editor.getContent(),division_id:this.selectedDivision.divisionId,tags:this.selectedTags.map((function(e){return{name:e.name}}))}).then(Object(H["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.messageSuccess("发送成功"),t.next=3,Q(1e3);case 3:e.holeComp.refresh(),e.editor.setContent(""),e.selectedTags=[];case 6:case"end":return t.stop()}}),t)})))).catch((function(t){console.log(t.response),e.messageError(t.response.data.msg)})))}},{key:"getTags",value:function(){var e=this;this.$axios.get("/tags").then((function(t){e.tags=t.data})).catch((function(t){console.log(t.data),e.messageError(t.data.msg)}))}},{key:"mounted",value:function(){var e=this;this.$nextTick((function(){e.checkDevice()})),window.addEventListener("resize",(function(){e.checkDevice()}))}},{key:"destroyed",value:function(){window.removeEventListener("resize",this.checkDevice)}},{key:"onShowFloatBtnChanged",value:function(e){this.showFloatBtn=!e}},{key:"selectedTagsChanged",value:function(){for(var e=this,t=0;t<this.selectedTags.length;t++)if("object"!==Object(za["a"])(this.selectedTags[t])){var a=function(){var a=e.selectedTags[t].name.trim();return a.length>8?(e.errorMsg.tags="标签不能超过8个字符",e.selectedTags.pop(),"break"):e.tags.find((function(e){return e.name.toLowerCase()===a.toLowerCase()}))?(e.errorMsg.tags="标签不能重复",e.selectedTags.pop(),"break"):0===a.length?(e.errorMsg.tags="标签不能为空",e.selectedTags.pop(),"break"):(e.errorMsg.tags="",void(e.selectedTags[t]={name:a,temperature:0,tagId:-1}))}();if("break"===a)break}}}]),a}(Fa);Object(u["a"])([Object(v["d"])()],No.prototype,"holeComp",void 0),Object(u["a"])([Object(v["d"])()],No.prototype,"editor",void 0),Object(u["a"])([Object(v["d"])()],No.prototype,"form",void 0),Object(u["a"])([Object(v["e"])("selectedTags")],No.prototype,"selectedTagsChanged",null),No=Object(u["a"])([Object(v["a"])({components:{Editor:tn,Newcomer:un,HolePanel:Mo,HoleListMobile:Bo}})],No);var Po=No,Uo=Po,Wo=(a("5386"),a("2b5d")),zo=Object(D["a"])(Uo,Ua,Wa,!1,null,"4978b912",null),Go=zo.exports;oe()(zo,{VBtn:Pe["a"],VCard:rt["a"],VCardActions:st["a"],VCardText:st["c"],VCardTitle:st["d"],VChip:ie["a"],VCombobox:Wo["a"],VContainer:Ba["a"],VDialog:ln["a"],VForm:Qt["a"],VIcon:Ue["a"],VListItemContent:Bt["a"],VSpacer:xt["a"]});var Yo=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{attrs:{"fill-height":""}},[a("v-row",{attrs:{align:"center",justify:"center"}},[a("v-col",{staticClass:"text-center",attrs:{cols:"12",sm:"8",md:"6",lg:"4"}},[a("v-card",{staticClass:"py-8",attrs:{elevation:"4"}},[a("div",{staticClass:"text-h4 pb-2"},[e._v("欢迎注册")]),a("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[a("v-alert",{staticClass:"my-4",attrs:{transition:"slide-y-transition",type:e.alertType,value:e.isAlert}},[e._v(" "+e._s(e.alertMsg)+" ")]),a("div",{staticClass:"pl-7 pr-10"},[a("v-text-field",{attrs:{label:"edu邮箱","prepend-icon":"mdi-email","error-messages":e.errorMsg["email"],clearable:!e.valid,counter:32,rules:e.notEmptyRules},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}}),a("v-row",{staticStyle:{"margin-bottom":"-12px"},attrs:{align:"center",justify:"center"}},[a("v-col",{attrs:{cols:"6",sm:"8"}},[a("v-text-field",{attrs:{label:"邮件验证码","prepend-icon":"mdi-email-check","error-messages":e.errorMsg["code"],clearable:!e.valid,counter:6,rules:e.codeRules},model:{value:e.code,callback:function(t){e.code=t},expression:"code"}})],1),a("v-col",{attrs:{cols:"6",sm:"4"}},[a("v-btn",{attrs:{color:"primary",block:"",disabled:!e.sendValid},on:{click:e.sendCode}},[e._v(" "+e._s(e.sendButton)+" ")])],1)],1),a("v-text-field",{attrs:{label:"密码",type:"password","prepend-icon":"mdi-lock",clearable:!e.valid,counter:32,rules:e.passwordRules},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),a("v-text-field",{attrs:{label:"重复密码",type:"password","prepend-icon":"mdi-lock","error-messages":e.errorMsg["password"],clearable:!e.valid,counter:32,rules:e.passwordRules},model:{value:e.password2,callback:function(t){e.password2=t},expression:"password2"}}),a("v-row",{staticStyle:{"margin-bottom":"-12px"},attrs:{align:"center",justify:"center"}},[a("v-checkbox",{attrs:{label:"同意"},model:{value:e.agreelicenses,callback:function(t){e.agreelicenses=t},expression:"agreelicenses"}}),a("a",{attrs:{href:"/#/license",target:"_blank"}},[e._v("相关协议")])],1)],1),a("div",{staticClass:"px-10"},[a("v-btn",{staticClass:"my-4",attrs:{color:"success",block:"",disabled:!(e.agreelicenses&&e.valid)},on:{click:e.register}},[e._v("注册 ")])],1)],1)],1)],1)],1)],1)},Jo=[],Xo=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.agreelicenses=!1,e.password="",e.password2="",e.email="",e.code="",e.sendButton="发送验证码",e.sendValid=!0,e.valid=!0,e.isAlert=!1,e.alertMsg="",e.alertType="info",e.errorMsg={email:"",password:""},e.notEmptyRules=[function(e){return!!e||"内容不能为空"}],e.codeRules=[function(e){return!!e||"内容不能为空"},function(e){return/^[0-9]{6}$/.test(e)||"验证码格式不对"}],e.passwordRules=[function(e){return!!e||"内容不能为空"},function(e){return e.length<=32||"密码不能超过32字符"},function(e){return e.length>=8||"密码不能少于8字符"}],e}return Object(s["a"])(a,[{key:"checkEmail",value:function(){/^[0-9]{11}@(m\.)?fudan\.edu\.cn$/.test(this.email)?this.errorMsg.email="":this.errorMsg.email="@fudan.edu.cn"}},{key:"checkPassword",value:function(){this.password!==this.password2?this.errorMsg.password="两次输入不一致":this.errorMsg.password=""}},{key:"sendCode",value:function(){var e=this;this.email?(this.sendButtonChangeStatus(),this.messageInfo("验证码已发送, 请检查邮件以继续"),this.$axios.get("/verify/email",{params:{email:this.email}}).then((function(t){"邮箱不在白名单内！"===t.data.message?e.messageError(t.data.message):e.messageSuccess(t.data.message)}))):this.messageError("用户名与邮箱不能为空")}},{key:"sendButtonChangeStatus",value:function(){var e=this;this.sendValid=!1;for(var t=function(t){setTimeout((function(){e.sendButton=t.toString(),"0"===e.sendButton&&(e.sendButton="发送验证码",e.sendValid=!0)}),1e3*(60-t))},a=60;a>=0;a--)t(a)}},{key:"register",value:function(){var e=this;this.form.validate()&&this.$axios.post("/register",{email:this.email,password:this.password,verification:parseInt(this.code)}).then((function(t){e.messageSuccess("注册成功！"),ga.setNewcomer("true"),ga.setToken("token "+t.data.token),setTimeout((function(){e.$router.replace("/home")}),1e3)})).catch((function(t){e.messageError(t.response.data.message)}))}},{key:"emailChanged",value:function(){this.debouncedCheckEmail()}},{key:"password2Changed",value:function(){this.debouncedCheckPassword()}},{key:"created",value:function(){this.debouncedCheckEmail=Object(Ra["a"])(this.checkEmail,1e3),this.debouncedCheckPassword=Object(Ra["a"])(this.checkPassword,500)}}]),a}(Fa);Object(u["a"])([Object(v["d"])()],Xo.prototype,"form",void 0),Object(u["a"])([Object(v["e"])("email")],Xo.prototype,"emailChanged",null),Object(u["a"])([Object(v["e"])("password2")],Xo.prototype,"password2Changed",null),Xo=Object(u["a"])([v["a"]],Xo);var Ko=Xo,Qo=Ko,Zo=a("0798"),ei=a("ac7c"),ti=Object(D["a"])(Qo,Yo,Jo,!1,null,null,null),ai=ti.exports;oe()(ti,{VAlert:Zo["a"],VBtn:Pe["a"],VCard:rt["a"],VCheckbox:ei["a"],VCol:qa["a"],VContainer:Ba["a"],VForm:Qt["a"],VRow:na["a"],VTextField:oa["a"]});var ni=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("FloorList",{attrs:{"wrapped-hole-or-id":e.computedDiscussionId,"display-floor-id":e.mentionFloorId}})},oi=[],ii=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){return Object(r["a"])(this,a),t.apply(this,arguments)}return Object(s["a"])(a,[{key:"computedDiscussionId",get:function(){return parseInt(this.$route.params.id)}},{key:"mentionFloorId",get:function(){return this.$route.query.mention&&"string"===typeof this.$route.query.mention?parseInt(this.$route.query.mention):-1}}]),a}(Fa);ii=Object(u["a"])([Object(v["a"])({components:{FloorList:Io}})],ii);var ri=ii,si=ri,li=(a("4a13"),Object(D["a"])(si,ni,oi,!1,null,"52401eb6",null)),ci=li.exports,ui=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{staticClass:"pa-0"},[e.isMobile?a("HoleListMobile",{ref:"holeComp"}):a("HolePanel",{ref:"holeComp",on:{"show-floor-list-changed":e.onShowFloatBtnChanged}}),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showFloatBtn,expression:"showFloatBtn"}],staticClass:"float-btn"},[a("v-btn",{attrs:{fab:"",color:"secondary"},on:{mousedown:function(e){e.preventDefault()},click:e.reload}},[a("v-icon",[e._v("mdi-autorenew")])],1),a("br"),a("v-dialog",{attrs:{persistent:"","max-width":"600px"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,o=t.attrs;return[a("v-btn",e._g(e._b({attrs:{fab:"",color:"secondary"},on:{mousedown:function(e){e.preventDefault()},click:e.openDialog}},"v-btn",o,!1),n),[a("v-icon",[e._v("mdi-message-plus")])],1)]}}]),model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[a("v-card",[a("v-card-title",[a("span",{staticClass:"headline"},[e._v("发表树洞")])]),a("v-card-text",[a("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[a("v-combobox",{attrs:{items:e.divisions,"item-text":"name",label:"分区","hide-selected":""},model:{value:e.selectedDivision,callback:function(t){e.selectedDivision=t},expression:"selectedDivision"}}),a("v-combobox",{attrs:{items:e.tags,"item-text":"name","item-value":"name",label:"标签",hint:"回车新增标签",rules:e.tagRules,"error-messages":e.errorMsg["tags"],counter:5,"hide-selected":"",clearable:"",multiple:""},scopedSlots:e._u([{key:"selection",fn:function(t){return[a("v-chip",e._b({key:JSON.stringify(t.item),attrs:{"input-value":t.selected,disabled:t.disabled,outlined:"",color:"red",small:""},on:{"click:close":function(e){return t.parent.selectItem(t.item)}}},"v-chip",t.attrs,!1),[e._v(" "+e._s(t.item.name)+" "),a("span",{staticClass:"tag-icon"},[a("v-icon",{attrs:{"x-small":""}},[e._v("mdi-fire")])],1),a("span",[e._v(" "+e._s(t.item.temperature)+" ")])])]}},{key:"item",fn:function(t){return[a("v-list-item-content",[a("span",{class:"red--text"},[e._v(" "+e._s(t.item.name)+" "),a("v-icon",{staticClass:"tag-icon",attrs:{color:"red",small:""}},[e._v("mdi-fire")]),a("span",{staticClass:"tag-count"},[e._v(" "+e._s(t.item.temperature)+" ")])],1)])]}}]),model:{value:e.selectedTags,callback:function(t){e.selectedTags=t},expression:"selectedTags"}}),a("editor",{ref:"editor",attrs:{contentName:e.contentName},on:{error:e.editorError}})],1)],1),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"primary",text:""},on:{click:e.closeDialog}},[e._v(" 关闭")]),a("v-btn",{attrs:{color:"primary",text:"",disabled:!e.valid},on:{click:e.addHole}},[e._v(" 发送 ")])],1)],1)],1)],1)],1)},di=[],hi=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.lineHeight=0,e.scrollTop=0,e.content="",e.tags=[],e.selectedTags=[],e.selectedDivision={divisionId:0,description:"",name:"",pinned:[]},e.filtedTag=null,e.dialog=!1,e.tagRules=[function(e){return e.length<=5||"标签不能多于5个"}],e.contentRules=[function(e){return!!e.trim()||"内容不能为空"}],e.errorMsg={},e.valid=!0,e.params={},e.showFloatBtn=!0,e}return Object(s["a"])(a,[{key:"divisions",get:function(){return ge.divisions}},{key:"contentName",get:function(){return"home-content"}},{key:"reload",value:function(){var e;this.clearTag(null!==(e=this.$route.name)&&void 0!==e?e:void 0),this.holeComp.refresh()}},{key:"editorError",value:function(e){this.messageError(e)}},{key:"openDialog",value:function(){var e=this;this.getTags(),this.selectedDivision=ge.divisions[0],ge.divisions.forEach((function(t){t.divisionId.toString()===e.$route.params.id&&(e.selectedDivision=t)}))}},{key:"closeDialog",value:function(){this.dialog=!1,this.errorMsg={},this.valid=!0}},{key:"addHole",value:function(){var e=this;this.form.validate()&&this.editor.validate()&&(this.closeDialog(),this.$axios.post("/holes",{content:this.editor.getContent(),division_id:this.selectedDivision.divisionId,tags:this.selectedTags.map((function(e){return{name:e.name}}))}).then((function(t){console.log(t.data),e.messageSuccess("发送成功"),e.holeComp.refresh(),e.editor.setContent(""),e.selectedTags=[]})).catch((function(t){console.log(t.response),e.messageError(t.response.data.msg)})))}},{key:"getTags",value:function(){var e=this;this.$axios.get("/tags").then((function(t){e.tags=t.data})).catch((function(t){console.log(t.data),e.messageError(t.data.msg)}))}},{key:"mounted",value:function(){var e=this;this.$nextTick((function(){e.checkDevice()})),window.addEventListener("resize",(function(){e.checkDevice()}))}},{key:"destroyed",value:function(){window.removeEventListener("resize",this.checkDevice)}},{key:"onShowFloatBtnChanged",value:function(e){this.showFloatBtn=!e}},{key:"selectedTagsChanged",value:function(){for(var e=this,t=0;t<this.selectedTags.length;t++)if("object"!==Object(za["a"])(this.selectedTags[t])){var a=function(){var a=e.selectedTags[t].name.trim();return a.length>8?(e.errorMsg.tags="标签不能超过8个字符",e.selectedTags.pop(),"break"):e.tags.find((function(e){return e.name.toLowerCase()===a.toLowerCase()}))?(e.errorMsg.tags="标签不能重复",e.selectedTags.pop(),"break"):0===a.length?(e.errorMsg.tags="标签不能为空",e.selectedTags.pop(),"break"):(e.errorMsg.tags="",void(e.selectedTags[t]={name:a,temperature:0,tagId:-1}))}();if("break"===a)break}}}]),a}(Fa);Object(u["a"])([Object(v["d"])()],hi.prototype,"holeComp",void 0),Object(u["a"])([Object(v["d"])()],hi.prototype,"editor",void 0),Object(u["a"])([Object(v["d"])()],hi.prototype,"form",void 0),Object(u["a"])([Object(v["e"])("selectedTags")],hi.prototype,"selectedTagsChanged",null),hi=Object(u["a"])([Object(v["a"])({components:{Editor:tn,HolePanel:Mo,HoleListMobile:Bo}})],hi);var pi=hi,vi=pi,fi=(a("8fde"),Object(D["a"])(vi,ui,di,!1,null,"420d6f24",null)),mi=fi.exports;oe()(fi,{VBtn:Pe["a"],VCard:rt["a"],VCardActions:st["a"],VCardText:st["c"],VCardTitle:st["d"],VChip:ie["a"],VCombobox:Wo["a"],VContainer:Ba["a"],VDialog:ln["a"],VForm:Qt["a"],VIcon:Ue["a"],VListItemContent:Bt["a"],VSpacer:xt["a"]});var gi=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",[a("v-card",[a("v-card-title",[e._v("FDU Hole")]),a("v-card-text",[e._v(" Made with ❤ by "),a("a",{attrs:{href:"https://github.com/fduhole",target:"_blank"}},[e._v("FDUHole-Dev")])]),a("v-card-text",[e._v(" 使用 FDU Hole 意味着你同意 "),a("router-link",{attrs:{to:"/license"}},[e._v(" 相关协议 ")])],1)],1),a("v-card",[a("v-card-title",[e._v("版本信息")]),e.installed?e._e():a("v-card-text",[e._v(" 您正在使用网页版 FDU Hole，请"),a("span",[e._v("安装本应用")]),e._v("以获得更好的体验！ ")]),a("v-card-text",[e._v(" 当前版本："+e._s(e.$feConfig.feVersion)),a("br"),e._v(" 最新版本："+e._s(e.latestVersion)+" "),a("br"),e._v(" "+e._s(e.updateMsg[e.updateMsgIndex])+" ")])],1),a("v-card",[a("v-card-title",[e._v("联系我们")]),a("v-card-subtitle",[e._v("项目首页")]),a("v-card-text",[a("a",{attrs:{href:e.$feConfig.feRepository}},[e._v(e._s(e.$feConfig.feRepository))])]),a("v-card-subtitle",[e._v("团队首页")]),a("v-card-text",[a("a",{attrs:{href:e.$feConfig.teamHomepage}},[e._v(e._s(e.$feConfig.teamHomepage))])]),a("v-card-subtitle",[e._v("团队邮箱")]),a("v-card-text",[a("a",{attrs:{href:"mailto:"+e.$feConfig.teamMail}},[e._v(" "+e._s(e.$feConfig.teamMail)+" ")])])],1),a("v-card",[a("v-card-title",[e._v("友情链接")]),a("v-card-text",[a("ul",e._l(e.$feConfig.friendLinks,(function(t,n){return a("li",{key:n},[a("a",{attrs:{href:t.link}},[e._v(e._s(t.author)+": "+e._s(t.siteName))])])})),0)])],1),a("v-card",[a("v-card-title",[a("a",{attrs:{href:"/report.html"}},[e._v(" 查看构建报告 ")])])],1)],1)},bi=[],yi=(a("1276"),function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.latestVersion="正在获取",e.installed=window.matchMedia("(display-mode: standalone)").matches,e.updateMsg=["您正在使用开发版，如遇 BUG 请前往 GitHub 提交 Issue 或 Pull Request！","检测到新版本，重载应用以升级！","您正在使用最新版的FDU Hole！"],e.updateMsgIndex=2,e}return Object(s["a"])(a,[{key:"updateUpdateMsgIndex",value:function(){var e=this.$feConfig.feVersion.split("."),t=this.latestVersion.split(".");return t[0]<e[0]||t[1]<e[1]||t[2]<e[2]?0:t[0]>e[0]||t[1]>e[1]||t[2]>e[2]?1:2}},{key:"getLatestVersion",value:function(){var e=this;this.$axios.request({url:this.$feConfig.latestReleasePkgJSON,transformRequest:[function(e,t){return delete t.Authorization,e}]}).then((function(t){e.latestVersion=t.data.version,e.updateMsgIndex=e.updateUpdateMsgIndex()})).catch((function(t){e.latestVersion="获取失败 "+t.message}))}},{key:"mounted",value:function(){this.getLatestVersion()}}]),a}(Fa));yi=Object(u["a"])([v["a"]],yi);var ki=yi,Oi=ki,ji=(a("0e19"),Object(D["a"])(Oi,gi,bi,!1,null,"b806e788",null)),wi=ji.exports;oe()(ji,{VCard:rt["a"],VCardSubtitle:st["b"],VCardText:st["c"],VCardTitle:st["d"],VContainer:Ba["a"]});var xi=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.searchStr?a("search-floor-list",{key:e.searchStr,attrs:{"search-str":e.searchStr}}):e._e()},Ci=[],_i=(a("841c"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",[a("v-row",{attrs:{justify:"center"}},[a("v-col",{attrs:{cols:"12",md:"8",lg:"6"}},[a("v-container",[a("transition-group",{attrs:{name:"slide-fade"}},e._l(e.floors,(function(t,n){return a("v-row",{directives:[{name:"viewer",rawName:"v-viewer"}],key:""+n,attrs:{justify:"center",align:"start"}},[a("v-col",[a("v-card",{attrs:{id:n}},[a("v-card-text",{staticClass:"pb-1 pt-2 text-body-2"},[a("p",[e._v(" "+e._s(t.anonyname)+" "),a("span",{staticStyle:{float:"right"}},[e._v(" "+e._s(e._f("timeDifference")(t.timeUpdated))+" ")])])]),a("v-card-text",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"py-0 clickable",on:{click:function(a){return e.gotoHole(t.holeId,t.floorId)}}},[a("div",{staticClass:"floor-body markdown-body rich-text text--primary ma-0 text-body-1",attrs:{index:n},domProps:{innerHTML:e._s(t.html)}})]),a("v-card-text",{staticClass:"d-flex text-body-2 pb-2"},[a("span",{staticClass:"clickable",on:{click:function(a){return e.gotoHole(t.holeId,t.floorId)}}},[e._v("#"+e._s(t.floorId))]),a("v-spacer"),a("span",{staticClass:"clickable",on:{click:function(a){return e.gotoHole(t.holeId)}}},[e._v("From #"+e._s(t.holeId))])],1)],1)],1)],1)})),1),a("loading",{ref:"loading",attrs:{request:[],"pause-loading":e.initiating}})],1)],1)],1)],1)}),Ii=[],Ei=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.floors=[],e.initiating=!0,e}return Object(s["a"])(a,[{key:"mounted",value:function(){var e=this;this.request=new Fn(this.searchStr),this.floors=this.request.datas,this.request.request().then((function(){e.initiating=!1})).catch((function(t){void 0===t.response?e.messageError(JSON.stringify(t)):e.messageError(t.response.data.msg)}))}},{key:"updated",value:function(){kt.a.highlightAll()}},{key:"gotoHole",value:function(e,t){this.$router.push("/home").then((function(){Mt(e,t)}))}}]),a}(F);Object(u["a"])([Object(v["c"])({required:!0})],Ei.prototype,"searchStr",void 0),Ei=Object(u["a"])([Object(v["a"])({components:{Mention:_t,Loading:Zn,Editor:tn}})],Ei);var Ti=Ei,Vi=Ti,$i=(a("ced5"),Object(D["a"])(Vi,_i,Ii,!1,null,"3665a831",null)),Si=$i.exports;oe()($i,{VCard:rt["a"],VCardText:st["c"],VCol:qa["a"],VContainer:Ba["a"],VRow:na["a"],VSpacer:xt["a"]}),On()($i,{Ripple:jn["a"]});var Di=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.searchStr="",e}return Object(s["a"])(a,[{key:"search",value:function(e){this.searchStr=e}},{key:"mounted",value:function(){this.$route.query.wd&&"string"===typeof this.$route.query.wd&&(this.searchStr=this.$route.query.wd),I.$on("search",this.search)}},{key:"destroyed",value:function(){I.$off("search",this.search)}}]),a}(Fa);Di=Object(u["a"])([Object(Ce["b"])({components:{SearchFloorList:Si}})],Di);var Mi=Di,Fi=Mi,Ri=Object(D["a"])(Fi,xi,Ci,!1,null,null,null),Li=Ri.exports,Hi=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{staticClass:"license"},[a("div",[a("p",[e._v("使用 FDU Hole 意味着你同意以下协议。")]),a("p",[e._v(" 如果您不同意以下协议，请立即删除该应用，关闭此网站，停止使用 FDU Hole 提供的的服务。 ")])]),a("v-expansion-panels",e._l(e.licenses,(function(t,n){return a("v-expansion-panel",{key:n},[a("v-expansion-panel-header",[e._v(" "+e._s(t.title)+" ")]),a("v-expansion-panel-content",{staticStyle:{overflow:"auto"}},[a("div",{staticClass:"license-view",domProps:{innerHTML:e._s(t.content)}})])],1)})),1)],1)},Ai=[],qi=(a("9911"),function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.licenses=[],e}return Object(s["a"])(a,[{key:"created",value:function(){var e,t=this,a=Object(p["a"])(this.$feConfig.licenses);try{for(a.s();!(e=a.n()).done;){var n=e.value;(function(e){t.$axios.request({url:e.link,transformRequest:[function(e,t){return delete t.Authorization,e}]}).then((function(a){t.licenses.push({title:e.name,content:ce()(J(a.data))})})).catch((function(a){t.licenses.push({title:e.name,content:"获取失败："+a.message})}))})(n)}}catch(o){a.e(o)}finally{a.f()}}}]),a}(Fa));qi=Object(u["a"])([v["a"]],qi);var Bi=qi,Ni=Bi,Pi=(a("530c"),a("cd55")),Ui=a("49e2"),Wi=a("c865"),zi=a("0393"),Gi=Object(D["a"])(Ni,Hi,Ai,!1,null,"1859f4f0",null),Yi=Gi.exports;oe()(Gi,{VContainer:Ba["a"],VExpansionPanel:Pi["a"],VExpansionPanelContent:Ui["a"],VExpansionPanelHeader:Wi["a"],VExpansionPanels:zi["a"]});var Ji=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.profile?a("v-container",[a("h1",[e._v("注册时间："+e._s(e.joinedTimeDisplayMsg))]),e.profile.isAdmin?a("h1",[e._v("您当前为管理员身份")]):e._e(),a("v-row",{staticStyle:{margin:"20px 0",width:"100%"},attrs:{justify:"space-around"}},[a("v-btn",{attrs:{color:"primary",width:"40%"},on:{click:e.changePassWd}},[e._v(" 修改密码 ")]),a("v-btn",{attrs:{color:"error",width:"40%"},on:{click:e.logout}},[e._v("退出登录")])],1)],1):e._e()},Xi=[],Ki=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.profile=null,e}return Object(s["a"])(a,[{key:"getUserInfo",value:function(){var e;this.profile=ge.userProfile,this.joinedTimeDisplayMsg=z(null===(e=ge.userProfile)||void 0===e?void 0:e.joinedTime)}},{key:"logout",value:function(){ga.clear(),ge.clear(),this.$router.push("/login")}},{key:"changePassWd",value:function(){this.$router.push("/changepassword")}},{key:"onPreloaded",value:function(){this.getUserInfo()}}]),a}(Fa);Ki=Object(u["a"])([Object(v["a"])({components:{DiscussionCard:xn}})],Ki);var Qi=Ki,Zi=Qi,er=Object(D["a"])(Zi,Ji,Xi,!1,null,null,null),tr=er.exports;oe()(er,{VBtn:Pe["a"],VContainer:Ba["a"],VRow:na["a"]});var ar=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{attrs:{"fill-height":""}},[a("v-row",{attrs:{align:"center",justify:"center"}},[a("v-col",{staticClass:"text-center",attrs:{cols:"12",sm:"8",md:"6",lg:"4"}},[a("v-card",{staticClass:"py-8",attrs:{elevation:"4"}},[a("div",{staticClass:"text-h4 pb-2"},[e._v("重置密码")]),a("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[a("v-alert",{staticClass:"my-4",attrs:{transition:"slide-y-transition",type:e.alertType,value:e.isAlert}},[e._v(" "+e._s(e.alertMsg)+" ")]),a("div",{staticClass:"pl-7 pr-10"},[a("v-row",{staticStyle:{"margin-bottom":"-12px"},attrs:{align:"center",justify:"center"}},[a("v-col",{attrs:{cols:"6",sm:"8"}},[a("v-text-field",{attrs:{label:"邮件验证码","prepend-icon":"mdi-email-check","error-messages":e.errorMsg["code"],clearable:!e.valid,counter:6,rules:e.codeRules},model:{value:e.code,callback:function(t){e.code=t},expression:"code"}})],1),a("v-col",{attrs:{cols:"6",sm:"4"}},[a("v-btn",{attrs:{color:"primary",block:"",disabled:!e.sendValid},on:{click:e.sendCode}},[e._v(" "+e._s(e.sendButton)+" ")])],1)],1),a("v-text-field",{attrs:{label:"密码",type:"password","prepend-icon":"mdi-lock",clearable:!e.valid,counter:32,rules:e.passwordRules},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),a("v-text-field",{attrs:{label:"重复密码",type:"password","prepend-icon":"mdi-lock","error-messages":e.errorMsg["password"],clearable:!e.valid,counter:32,rules:e.passwordRules},model:{value:e.password2,callback:function(t){e.password2=t},expression:"password2"}})],1),a("div",{staticClass:"px-10"},[a("v-btn",{staticClass:"my-4",attrs:{color:"success",block:"",disabled:!e.valid},on:{click:e.changepassword}},[e._v(" 修改 ")])],1)],1)],1)],1)],1)],1)},nr=[],or=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.password="",e.password2="",e.code="",e.sendButton="发送验证码",e.sendValid=!0,e.valid=!0,e.isAlert=!1,e.alertMsg="",e.alertType="info",e.errorMsg={email:"",password:""},e.codeRules=[function(e){return!!e||"内容不能为空"},function(e){return/^[0-9]{6}$/.test(e)||"验证码格式不对"}],e.passwordRules=[function(e){return!!e||"内容不能为空"},function(e){return e.length<=32||"密码不能超过32字符"},function(e){return e.length>=8||"密码不能少于8字符"}],e}return Object(s["a"])(a,[{key:"checkPassword",value:function(){this.password!==this.password2?this.errorMsg.password="两次输入不一致":this.errorMsg.password=""}},{key:"sendCode",value:function(){var e=this;this.sendButtonChangeStatus(),this.messageInfo("验证码已发送, 请检查邮件以继续"),this.$axios.get("/verify/email",{params:{email:ga.email}}).then((function(t){"邮箱不在白名单内！"===t.data.message?e.messageError(t.data.message):e.messageSuccess(t.data.message)}))}},{key:"sendButtonChangeStatus",value:function(){var e=this;this.sendValid=!1;for(var t=function(t){setTimeout((function(){e.sendButton=t.toString(),"0"===e.sendButton&&(e.sendButton="发送验证码",e.sendValid=!0)}),1e3*(60-t))},a=60;a>=0;a--)t(a)}},{key:"changepassword",value:function(){var e=this;this.form.validate()&&this.$axios.put("/register",{email:ga.email,password:this.password,verification:parseInt(this.code)}).then((function(){e.messageSuccess("修改密码成功！"),setTimeout((function(){e.$router.replace("/home")}),1e3)})).catch((function(t){e.messageError(t.response.data.message)}))}},{key:"password2Changed",value:function(){this.debouncedCheckPassword()}},{key:"created",value:function(){this.debouncedCheckPassword=Object(Ra["a"])(this.checkPassword,500)}}]),a}(Fa);Object(u["a"])([Object(v["d"])()],or.prototype,"form",void 0),Object(u["a"])([Object(v["e"])("password2")],or.prototype,"password2Changed",null),or=Object(u["a"])([v["a"]],or);var ir=or,rr=ir,sr=Object(D["a"])(rr,ar,nr,!1,null,null,null),lr=sr.exports;oe()(sr,{VAlert:Zo["a"],VBtn:Pe["a"],VCard:rt["a"],VCol:qa["a"],VContainer:Ba["a"],VForm:Qt["a"],VRow:na["a"],VTextField:oa["a"]});var cr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{attrs:{"fill-height":""}},[a("v-row",{attrs:{align:"center",justify:"center"}},[a("v-col",{staticClass:"text-center",attrs:{cols:"12",sm:"8",md:"6",lg:"4"}},[a("v-card",{staticClass:"py-8",attrs:{elevation:"4"}},[a("div",{staticClass:"text-h4 pb-2"},[e._v("重置密码")]),a("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[a("v-alert",{staticClass:"my-4",attrs:{transition:"slide-y-transition",type:e.alertType,value:e.isAlert}},[e._v(" "+e._s(e.alertMsg)+" ")]),a("div",{staticClass:"pl-7 pr-10"},[a("v-text-field",{attrs:{label:"edu邮箱","prepend-icon":"mdi-email","error-messages":e.errorMsg["email"],clearable:!e.valid,counter:32,rules:e.notEmptyRules},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}}),a("v-row",{staticStyle:{"margin-bottom":"-12px"},attrs:{align:"center",justify:"center"}},[a("v-col",{attrs:{cols:"6",sm:"8"}},[a("v-text-field",{attrs:{label:"邮件验证码","prepend-icon":"mdi-email-check","error-messages":e.errorMsg["code"],clearable:!e.valid,counter:6,rules:e.codeRules},model:{value:e.code,callback:function(t){e.code=t},expression:"code"}})],1),a("v-col",{attrs:{cols:"6",sm:"4"}},[a("v-btn",{attrs:{color:"primary",block:"",disabled:!e.sendValid},on:{click:e.sendCode}},[e._v(" "+e._s(e.sendButton)+" ")])],1)],1),a("v-text-field",{attrs:{label:"密码",type:"password","prepend-icon":"mdi-lock",clearable:!e.valid,counter:32,rules:e.passwordRules},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),a("v-text-field",{attrs:{label:"重复密码",type:"password","prepend-icon":"mdi-lock","error-messages":e.errorMsg["password"],clearable:!e.valid,counter:32,rules:e.passwordRules},model:{value:e.password2,callback:function(t){e.password2=t},expression:"password2"}})],1),a("div",{staticClass:"px-10"},[a("v-btn",{staticClass:"my-4",attrs:{color:"success",block:"",disabled:!e.valid},on:{click:e.changepassword}},[e._v(" 修改 ")])],1)],1)],1)],1)],1)],1)},ur=[],dr=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.password="",e.password2="",e.email="",e.code="",e.sendButton="发送验证码",e.sendValid=!0,e.valid=!0,e.isAlert=!1,e.alertMsg="",e.alertType="info",e.errorMsg={email:"",password:""},e.notEmptyRules=[function(e){return!!e||"内容不能为空"}],e.codeRules=[function(e){return!!e||"内容不能为空"},function(e){return/^[0-9]{6}$/.test(e)||"验证码格式不对"}],e.passwordRules=[function(e){return!!e||"内容不能为空"},function(e){return e.length<=32||"密码不能超过32字符"},function(e){return e.length>=8||"密码不能少于8字符"}],e}return Object(s["a"])(a,[{key:"checkEmail",value:function(){/^[0-9]{11}@(m\.)?fudan\.edu\.cn$/.test(this.email)?this.errorMsg.email="":this.errorMsg.email="@fudan.edu.cn"}},{key:"checkPassword",value:function(){this.password!==this.password2?this.errorMsg.password="两次输入不一致":this.errorMsg.password=""}},{key:"sendCode",value:function(){var e=this;this.email?(this.sendButtonChangeStatus(),this.messageInfo("验证码已发送, 请检查邮件以继续"),this.$axios.get("/verify/email",{params:{email:this.email}}).then((function(t){"邮箱不在白名单内！"===t.data.message?e.messageError(t.data.message):e.messageSuccess(t.data.message)}))):this.messageError("用户名与邮箱不能为空")}},{key:"sendButtonChangeStatus",value:function(){var e=this;this.sendValid=!1;for(var t=function(t){setTimeout((function(){e.sendButton=t.toString(),"0"===e.sendButton&&(e.sendButton="发送验证码",e.sendValid=!0)}),1e3*(60-t))},a=60;a>=0;a--)t(a)}},{key:"changepassword",value:function(){var e=this;this.form.validate()&&this.$axios.put("/register",{email:this.email,password:this.password,verification:parseInt(this.code)}).then((function(){e.messageSuccess("重置密码成功！"),setTimeout((function(){e.$router.replace("/login")}),1e3)})).catch((function(t){e.messageError(t.response.data.message)}))}},{key:"emailChanged",value:function(){this.debouncedCheckEmail()}},{key:"password2Changed",value:function(){this.debouncedCheckPassword()}},{key:"created",value:function(){this.debouncedCheckEmail=Object(Ra["a"])(this.checkEmail,1e3),this.debouncedCheckPassword=Object(Ra["a"])(this.checkPassword,500)}}]),a}(Fa);Object(u["a"])([Object(v["d"])()],dr.prototype,"form",void 0),Object(u["a"])([Object(v["e"])("email")],dr.prototype,"emailChanged",null),Object(u["a"])([Object(v["e"])("password2")],dr.prototype,"password2Changed",null),dr=Object(u["a"])([v["a"]],dr);var hr=dr,pr=hr,vr=Object(D["a"])(pr,cr,ur,!1,null,null,null),fr=vr.exports;oe()(vr,{VAlert:Zo["a"],VBtn:Pe["a"],VCard:rt["a"],VCol:qa["a"],VContainer:Ba["a"],VForm:Qt["a"],VRow:na["a"],VTextField:oa["a"]});var mr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{staticClass:"pa-0"},[e.isMobile?a("HoleListMobile"):a("HolePanel")],1)},gr=[],br=function(e){Object(l["a"])(a,e);var t=Object(c["a"])(a);function a(){return Object(r["a"])(this,a),t.apply(this,arguments)}return a}(Fa);br=Object(u["a"])([Object(v["a"])({components:{HolePanel:Mo,HoleListMobile:Bo}})],br);var yr=br,kr=yr,Or=Object(D["a"])(kr,mr,gr,!1,null,"c9b57628",null),jr=Or.exports;oe()(Or,{VContainer:Ba["a"]}),n["default"].use(_a["a"]);var wr=[{path:"/license",meta:{title:"协议"},component:Yi,name:"license"},{path:"/home",meta:{title:"首页"},component:Go,name:"home"},{path:"/login",meta:{title:"登录"},component:Pa,name:"login"},{path:"/division/:id",meta:{title:"分区"},component:mi,name:"division"},{path:"/collections",meta:{title:"收藏"},component:jr,name:"collections"},{path:"/search",meta:{title:"搜索"},component:Li,name:"search"},{path:"/",redirect:"/home"},{path:"/about",meta:{title:"关于"},component:wi,name:"about"},{path:"/register",meta:{title:"注册"},component:ai,name:"register"},{path:"/changepassword",meta:{title:"修改密码"},component:lr,name:"changepassword"},{path:"/forgetpassword",meta:{title:"重置密码"},component:fr,name:"forgetpassword"},{path:"/hole/:id",meta:{title:"树洞"},component:ci,name:"hole"},{path:"/me",meta:{title:"我的"},component:tr,name:"me"}],xr=new _a["a"]({routes:wr});xr.beforeEach((function(e,t,a){return e.meta.title&&(document.title=e.meta.title),"/login"===e.path||"/forgetpassword"===e.path||"/register"===e.path||"/license"===e.path?a():ga.token?void a():a("/login")}));var Cr=xr,_r=a("bc3a"),Ir=a.n(_r),Er=a("2b27"),Tr=a.n(Er);function Vr(e){}var $r=Vr,Sr=(a("0808"),a("6944")),Dr=a.n(Sr),Mr=a("9224"),Fr={feRepository:"https://www.github.com/fduhole/vue",teamHomepage:"https://www.github.com/fduhole",teamMail:"fduhole@gmail.com",latestReleasePkgJSON:"https://cdn.jsdelivr.net/gh/fduhole/vue@master/package.json",feVersion:Mr.version,backEndApi:"https://hole.hath.top/",backEndWebsocketApi:"wss://hole.hath.top/ws/notification",licenses:[{name:"社区公约",link:"https://cdn.jsdelivr.net/gh/fduhole/vue@master/community-agreement.md"},{name:"使用条款",link:"https://cdn.jsdelivr.net/gh/fduhole/vue@master/terms-of-use.md"},{name:"隐私政策",link:"https://cdn.jsdelivr.net/gh/fduhole/vue@master/privacy-policy.md"},{name:"开源协议",link:"https://cdn.jsdelivr.net/gh/fduhole/vue@master/open-source-licenses.md"}],allowBackRoutes:["discussion","license","search"],banMenuRoutes:["login","register","license","discussion","search"],navItems:[{title:"首页",icon:"mdi-home",route:"/home"},{title:"分区",icon:"mdi-home",route:"/division",group:!0},{title:"收藏",icon:"mdi-star",route:"/collections"},{title:"我的",icon:"mdi-account",route:"/me"},{title:"关于",icon:"mdi-information",route:"/about"}],friendLinks:[{siteName:"旦夕 App",author:"DanXi-Dev",link:"https://danxi-dev.github.io"}]},Rr=(a("a753"),a("8096"),a("14e1"),function(){function e(){Object(r["a"])(this,e),this.ws=null,this.unhandledMessages=[]}return Object(s["a"])(e,[{key:"isConnecting",value:function(){return!!this.ws&&this.ws.readyState===WebSocket.CONNECTING}},{key:"isConnected",value:function(){return!!this.ws&&this.ws.readyState===WebSocket.OPEN}},{key:"connect",value:function(){var e=ga.tokenNoPrefix;if(!e)throw new Error("No Token!");this.ws=new WebSocket("".concat(pe.$feConfig.backEndWebsocketApi,"?token=").concat(e)),this.ws.onmessage=this.onMessage,this.ws.onopen=this.onOpen,this.ws.onerror=this.onError,this.ws.onclose=this.onClose}},{key:"send",value:function(e){this.ws?this.ws.send(e):this.unhandledMessages.push(e)}},{key:"sendAction",value:function(e){this.send(JSON.stringify(e))}},{key:"onOpen",value:function(){pe.$ws.unhandledMessages.length>0&&(pe.$ws.unhandledMessages.forEach((function(e){var t;null===(t=pe.$ws.ws)||void 0===t||t.send(e)})),pe.$ws.unhandledMessages=[])}},{key:"onError",value:function(){}},{key:"onClose",value:function(){pe.$ws.ws=null}},{key:"onMessage",value:function(e){var t="string"===typeof e.data?JSON.parse(e.data):e.data,a=Je(Y(t));a&&I.$emit("receive-ws-message",a)}}]),e}()),Lr=new Rr;n["default"].prototype.$feConfig=Fr,n["default"].prototype.$ws=Lr,n["default"].config.productionTip=!1,Ir.a.defaults.baseURL=Fr.backEndApi,Ir.a.interceptors.request.use((function(e){return e.headers.Authorization=localStorage.getItem("token"),e})),n["default"].prototype.$axios=Ir.a,n["default"].use(Tr.a),n["default"].use($r),n["default"].use(Dr.a),n["default"].filter("plainText",(function(e){return e.replace(/<img.*?>/g,"[图片]").replace(/<.*?>/g," ").replace(/#\w+/g,(function(e){return"[回复"+e+"]"}))})),n["default"].filter("wordLimit",(function(e){var t=document.body.clientWidth<=454?30:40;return e.length>t?e.substring(0,t-4)+" ...":e})),n["default"].filter("timeDifference",G);var Hr=new n["default"]({router:Cr,vuetify:Tt,store:g,render:function(e){return e(xa)}}).$mount("#app")},ced5:function(e,t,a){"use strict";a("96b7")},d1f0:function(e,t,a){},db67:function(e,t,a){},e12e:function(e,t,a){},f240:function(e,t,a){"use strict";a("1f4a")}});
//# sourceMappingURL=app.8509cf3a.js.map